/*!
* OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["sap/ui/integration/library","sap/ui/integration/cards/BaseContent","sap/m/library","sap/m/HBox","sap/m/VBox","sap/m/Text","sap/m/Title","sap/m/Avatar","sap/m/Link","sap/m/Label","sap/base/Log","sap/ui/core/ResizeHandler","sap/ui/layout/AlignedFlowLayout","sap/ui/dom/units/Rem","sap/ui/integration/util/BindingHelper","sap/ui/integration/util/Utils"],function(l,B,L,H,V,T,a,A,b,c,d,R,e,f,g,U){"use strict";var h=L.AvatarSize;var i=L.AvatarColor;var F=L.FlexRendertype;var j=l.CardActionArea;var O=B.extend("sap.ui.integration.cards.ObjectContent",{metadata:{library:"sap.ui.integration"},renderer:{apiVersion:2}});O.prototype._getRootContainer=function(){if(this._bIsBeingDestroyed){return null;}var o=this.getAggregation("_content");if(!o){o=new e();this.setAggregation("_content",o);}this._sResizeListenerId=R.register(o,this.onAlignedFlowLayoutResize.bind(this));o.addEventDelegate({"onAfterRendering":function(){this.getContent().forEach(function(E){if(!E.getVisible()){document.getElementById("sap-ui-invisible-"+E.getId()).parentElement.classList.add("sapFCardInvisibleContent");}});}},o);return o;};O.prototype.onAlignedFlowLayoutResize=function(E){if(E&&(E.size.width===E.oldSize.width)&&!E.control){return;}var C=E.control,m=C.getMinItemWidth(),n=C.getContent().length,M;if(m.lastIndexOf("rem")!==-1){M=f.toPx(m);}else if(m.lastIndexOf("px")!==-1){M=parseFloat(m);}var k=Math.floor(E.size.width/M);if(k>n){k=n;}if(this._iColsOld===k){return;}this._iColsOld=k;var o=k-1,r=Math.ceil(n/k);C.getContent().forEach(function(I,p){I.addStyleClass("sapFCardObjectSpaceBetweenGroup");if(o===p&&o<n){I.removeStyleClass("sapFCardObjectSpaceBetweenGroup");o+=k;}if(p+1>(r-1)*k){I.addStyleClass("sapFCardObjectGroupLastInColumn");}else{I.removeStyleClass("sapFCardObjectGroupLastInColumn");}});};O.prototype.exit=function(){B.prototype.exit.apply(this,arguments);if(this._sResizeListenerId){R.deregister(this._sResizeListenerId);this._sResizeListenerId="";}};O.prototype.setConfiguration=function(C){B.prototype.setConfiguration.apply(this,arguments);C=this.getParsedConfiguration();if(!C){return this;}if(C.groups){this._addGroups(C);}return this;};O.prototype._addGroups=function(C){var o=this._getRootContainer(),G=C.groups||[];G.forEach(function(k){var v;if(typeof k.visible=="string"){v=!U.hasFalsyValueAsString(k.visible);}else{v=k.visible;}var m=new V({visible:v,renderType:F.Bare}).addStyleClass("sapFCardObjectGroup");if(k.title){m.addItem(new a({text:k.title}).addStyleClass("sapFCardObjectItemTitle"));m.addStyleClass("sapFCardObjectGroupWithTitle");}k.items.forEach(function(I){this._createGroupItems(I).forEach(m.addItem,m);},this);o.addContent(m);},this);this._oActions.attach({area:j.Content,actions:C.actions,control:this});};O.prototype._createGroupItems=function(I){var v=I.label,k=I.value,o,m,C,n,p=[];if(typeof I.visible=="string"){m=!U.hasFalsyValueAsString(I.visible);}else{m=I.visible;}if(v){v=g.formattedProperty(v,function(s){return s&&s[s.length-1]===":"?s:s+":";});o=new c({text:v,visible:m}).addStyleClass("sapFCardObjectItemLabel");}if(k&&I.actions){C=new b({text:k,visible:g.reuse(m)});if(o){C.addAriaLabelledBy(o);}else{d.warning("Missing label for Object group item with actions.",null,"sap.ui.integration.widgets.Card");}this._oActions.attach({area:j.ContentItemDetail,actions:I.actions,control:this,actionControl:C,enabledPropertyName:"enabled"});}if(k&&!I.actions&&I.type){d.warning("Usage of Object Group Item property 'type' is deprecated. Use Card Actions for navigation.",null,"sap.ui.integration.widgets.Card");switch(I.type){case'link':C=new b({href:I.url||k,text:k,target:I.target||'_blank',visible:g.reuse(m)});break;case'email':if(I.value){p.push(I.value);}if(I.emailSubject){p.push(I.emailSubject);}n=g.formattedProperty(p,function(s,E){if(E){return"mailto:"+s+"?subject="+E;}else{return"mailto:"+s;}});C=new b({href:n,text:k,visible:g.reuse(m)});break;case'phone':n=g.formattedProperty(k,function(s){return"tel:"+s;});C=new b({href:n,text:k,visible:g.reuse(m)});break;default:}}if(k&&!C){C=new T({text:k,visible:g.reuse(m)});}if(C){C.addStyleClass("sapFCardObjectItemText");}if(I.icon){var q=new V({renderType:F.Bare,items:[o,C]});var r=new H({visible:m,renderType:F.Bare,items:[this._createGroupItemAvatar(I.icon),q]}).addStyleClass("sapFCardObjectItemLabel");return[r];}else{return[o,C];}};O.prototype._createGroupItemAvatar=function(I){var s=g.formattedProperty(I.src,function(v){return this._oIconFormatter.formatSrc(v);}.bind(this));var o=new A({displaySize:I.size||h.XS,src:s,initials:I.text,displayShape:I.shape,tooltip:I.alt,backgroundColor:I.backgroundColor||(I.text?undefined:i.Transparent)}).addStyleClass("sapFCardObjectItemAvatar sapFCardIcon");return o;};return O;});
