/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Element','./DynamicDateOption','./Label','./StepInput','./RadioButton','./RadioButtonGroup','sap/ui/unified/Calendar','sap/ui/unified/calendar/MonthPicker','sap/ui/core/format/DateFormat','sap/ui/core/date/UniversalDateUtils','sap/ui/core/date/UniversalDate','sap/m/DynamicDateValueHelpUIType','./library'],function(E,D,L,S,R,a,C,M,b,U,c,d,l){"use strict";var e=D.extend("sap.m.StandardDynamicDateOption",{metadata:{library:"sap.m"}});var f=1;var g=6000;var K={"DATE":"DATE","DATERANGE":"DATERANGE","TODAY":"TODAY","YESTERDAY":"YESTERDAY","TOMORROW":"TOMORROW","SPECIFICMONTH":"SPECIFICMONTH","THISWEEK":"THISWEEK","THISMONTH":"THISMONTH","THISQUARTER":"THISQUARTER","THISYEAR":"THISYEAR","LASTWEEK":"LASTWEEK","LASTMONTH":"LASTMONTH","LASTQUARTER":"LASTQUARTER","LASTYEAR":"LASTYEAR","NEXTWEEK":"NEXTWEEK","NEXTMONTH":"NEXTMONTH","NEXTQUARTER":"NEXTQUARTER","NEXTYEAR":"NEXTYEAR","LASTDAYS":"LASTDAYS","LASTWEEKS":"LASTWEEKS","LASTMONTHS":"LASTMONTHS","LASTQUARTERS":"LASTQUARTERS","LASTYEARS":"LASTYEARS","NEXTDAYS":"NEXTDAYS","NEXTWEEKS":"NEXTWEEKS","NEXTMONTHS":"NEXTMONTHS","NEXTQUARTERS":"NEXTQUARTERS","NEXTYEARS":"NEXTYEARS","FROM":"FROM","TO":"TO","YEARTODATE":"YEARTODATE","DATETOYEAR":"DATETOYEAR","TODAYFROMTO":"TODAYFROMTO","QUARTER1":"QUARTER1","QUARTER2":"QUARTER2","QUARTER3":"QUARTER3","QUARTER4":"QUARTER4"};var _={"SingleDates":1,"DateRanges":2,"Weeks":3,"Months":4,"Quarters":5,"Years":6};var h={"DATE":_.SingleDates,"DATERANGE":_.DateRanges,"TODAY":_.SingleDates,"YESTERDAY":_.SingleDates,"TOMORROW":_.SingleDates,"SPECIFICMONTH":_.Months,"THISWEEK":_.Weeks,"THISMONTH":_.Months,"THISQUARTER":_.Quarters,"THISYEAR":_.Years,"LASTWEEK":_.Weeks,"LASTMONTH":_.Months,"LASTQUARTER":_.Quarters,"LASTYEAR":_.Years,"NEXTWEEK":_.Weeks,"NEXTMONTH":_.Months,"NEXTQUARTER":_.Quarters,"NEXTYEAR":_.Years,"LASTDAYS":_.DateRanges,"LASTWEEKS":_.DateRanges,"LASTMONTHS":_.DateRanges,"LASTQUARTERS":_.DateRanges,"LASTYEARS":_.DateRanges,"NEXTDAYS":_.DateRanges,"NEXTWEEKS":_.DateRanges,"NEXTMONTHS":_.DateRanges,"NEXTQUARTERS":_.DateRanges,"NEXTYEARS":_.DateRanges,"FROM":_.DateRanges,"TO":_.DateRanges,"YEARTODATE":_.DateRanges,"DATETOYEAR":_.DateRanges,"TODAYFROMTO":_.DateRanges,"QUARTER1":_.Quarters,"QUARTER2":_.Quarters,"QUARTER3":_.Quarters,"QUARTER4":_.Quarters};var j=["LASTDAYS","LASTWEEKS","LASTMONTHS","LASTQUARTERS","LASTYEARS"];var n=["NEXTDAYS","NEXTWEEKS","NEXTMONTHS","NEXTQUARTERS","NEXTYEARS"];e.LastXKeys=j;e.NextXKeys=n;var k=sap.ui.getCore().getLibraryResourceBundle("sap.m");e.Keys=K;e.prototype.exit=function(){if(this.aValueHelpUITypes){while(this.aValueHelpUITypes.length){this.aValueHelpUITypes.pop().destroy();}delete this.aValueHelpUITypes;}};e.prototype.getText=function(o){var s=this.getKey();var O=o._getOptions();var p=this.getValueHelpUITypes(o);var i=this._getOptionParams(j,O);var N=this._getOptionParams(n,O);if(i){p.push(i);}if(N){p.push(N);}switch(s){case K.LASTDAYS:case K.LASTWEEKS:case K.LASTMONTHS:case K.LASTQUARTERS:case K.LASTYEARS:return k.getText("DYNAMIC_DATE_LASTX_TITLE",p[1].getOptions().join(" / "));case K.NEXTDAYS:case K.NEXTWEEKS:case K.NEXTMONTHS:case K.NEXTQUARTERS:case K.NEXTYEARS:return k.getText("DYNAMIC_DATE_NEXTX_TITLE",p[1].getOptions().join(" / "));default:return k.getText("DYNAMIC_DATE_"+s+"_TITLE");}};e.prototype.getValueHelpUITypes=function(o){var s=this.getKey();if(!this.aValueHelpUITypes){switch(s){case K.TODAY:case K.YESTERDAY:case K.TOMORROW:case K.THISWEEK:case K.THISMONTH:case K.THISQUARTER:case K.THISYEAR:case K.LASTWEEK:case K.LASTMONTH:case K.LASTQUARTER:case K.LASTYEAR:case K.NEXTWEEK:case K.NEXTMONTH:case K.NEXTQUARTER:case K.NEXTYEAR:case K.YEARTODATE:case K.DATETOYEAR:case K.QUARTER1:case K.QUARTER2:case K.QUARTER3:case K.QUARTER4:this.aValueHelpUITypes=[];break;case K.DATE:case K.FROM:case K.TO:this.aValueHelpUITypes=[new d({type:"date"})];break;case K.DATERANGE:this.aValueHelpUITypes=[new d({type:"daterange"})];break;case K.SPECIFICMONTH:this.aValueHelpUITypes=[new d({type:"month"})];break;case K.LASTDAYS:case K.LASTWEEKS:case K.LASTMONTHS:case K.LASTQUARTERS:case K.LASTYEARS:case K.NEXTDAYS:case K.NEXTWEEKS:case K.NEXTMONTHS:case K.NEXTQUARTERS:case K.NEXTYEARS:this.aValueHelpUITypes=[new d({text:k.getText("DDR_LASTNEXTX_LABEL"),type:"int"})];break;case K.TODAYFROMTO:this.aValueHelpUITypes=[new d({text:k.getText("DDR_TODAYFROMTO_FROM_LABEL"),type:"int"}),new d({text:k.getText("DDR_TODAYFROMTO_TO_LABEL"),type:"int"})];break;}}return this.aValueHelpUITypes.slice(0);};e.prototype.createValueHelpUI=function(o,i){var O=o._getOptions();var v=o.getValue();var p=this.getValueHelpUITypes(o);var q=[];if(!o.aControlsByParameters){o.aControlsByParameters={};}o.aControlsByParameters[this.getKey()]=[];var r=this._getOptionParams(j,O);var N=this._getOptionParams(n,O);if(r){p.push(r);}if(N){p.push(N);}for(var I=0;I<p.length;I++){if(p[I].getOptions()&&p[I].getOptions().length<=1){break;}else if(p[I].getText()){q.push(new L({text:p[I].getText(),width:"100%"}));}var s;switch(p[I].getType()){case"int":s=this._createIntegerControl(v,I,i);if(v&&p[1]&&p[1].getOptions()&&p[1].getOptions().indexOf(v.operator.slice(4).toLowerCase())!==-1){s.setValue(v.values[I]);}break;case"date":s=this._createDateControl(v,I,i);break;case"daterange":s=this._createDateRangeControl(v,I,i);break;case"month":s=this._createMonthControl(v,I,i);break;case"options":s=this._createOptionsControl(v,I,i,p);break;}q.push(s);o.aControlsByParameters[this.getKey()].push(s);}return q;};e.prototype._createIntegerControl=function(v,i,o){var p=D.prototype._createIntegerControl.call(this,v,i,o);var q=this.getKey()==="TODAYFROMTO"?-g:f;var u=!v||this.getKey()!==v.operator;if(this.getKey()==="TODAYFROMTO"&&u){p.setValue(1);}p.setMin(q);p.setMax(g);return p;};e.prototype._createOptionsControl=function(v,i,o,p){var q=new a({buttons:[p[i].getOptions().map(m)]});if(v){var O=p[i].getOptions().indexOf(v.operator.slice(4).toLowerCase());if(O!==-1){q.setSelectedIndex(O);}}if(o instanceof Function){q.attachSelect(function(){o(this);},this);}return q;};e.prototype._getOptionParams=function(G,o){if(G.indexOf(this.getKey())!==-1){return new d({text:"Time Periods:",type:"options",options:o?o.filter(function(i){return G.indexOf(i.getKey())!==-1;}).map(function(i){return i.getKey().slice(4).toLowerCase();}):[]});}return undefined;};e.prototype.validateValueHelpUI=function(o){var p=this.getValueHelpUITypes();for(var i=0;i<p.length;i++){var I=o.aControlsByParameters[this.getKey()][i];switch(p[i].getType()){case"int":if(I._isLessThanMin(I.getValue())||I._isMoreThanMax(I.getValue())){return false;}break;case"month":case"date":case"daterange":if(!I.getSelectedDates()||I.getSelectedDates().length==0){return false;}break;case"options":if(I.getSelectedIndex()<0){return false;}break;}}return true;};e.prototype.getValueHelpOutput=function(o){var O=o._getOptions();var p=this.getValueHelpUITypes(o),r={},v;if(j.indexOf(this.getKey())!==-1&&o.aControlsByParameters[this.getKey()].length>1){r.operator=O.filter(function(s){return j.indexOf(s.getKey())!==-1;})[o.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey();}else if(n.indexOf(this.getKey())!==-1&&o.aControlsByParameters[this.getKey()].length>1){r.operator=O.filter(function(s){return n.indexOf(s.getKey())!==-1;})[o.aControlsByParameters[this.getKey()][1].getSelectedIndex()].getKey();}else{r.operator=this.getKey();}r.values=[];for(var i=0;i<p.length;i++){var I=o.aControlsByParameters[this.getKey()][i];switch(p[i].getType()){case"int":v=I.getValue();break;case"month":if(!I.getSelectedDates()||!I.getSelectedDates().length){return null;}v=I.getSelectedDates()[0].getStartDate().getMonth();break;case"date":if(!I.getSelectedDates().length){return null;}v=I.getSelectedDates()[0].getStartDate();break;case"daterange":if(!I.getSelectedDates().length){return null;}var q=I.getSelectedDates()[0].getEndDate()||I.getSelectedDates()[0].getStartDate();v=[I.getSelectedDates()[0].getStartDate(),q];break;}if(Array.isArray(v)){r.values=Array.prototype.concat.apply(r.values,v);}else{v!==null&&v!==undefined&&r.values.push(v);}}return r;};e.prototype.getGroup=function(){return h[this.getKey()];};e.prototype.getGroupHeader=function(){return k.getText("DDR_OPTIONS_GROUP_"+h[this.getKey()]);};e.prototype.format=function(o,F){return F.format(o);};e.prototype.parse=function(v,F){return F.parse(v,this.getKey());};e.prototype.toDates=function(v){if(!v){return null;}var s=v.operator;var p=v.values[0]||0;switch(s){case"SPECIFICMONTH":var o=new c();o.setMonth(v.values[0]);o=U.getMonthStartDate(o);return U.getRange(0,"MONTH",o);case"DATE":return U.getRange(0,"DAY",c.getInstance(v.values[0]));case"DATERANGE":var i=c.getInstance(v.values[0]);var q=c.getInstance(v.values[1]);return[U.resetStartTime(i),U.resetEndTime(q)];case"TODAY":return U.ranges.today();case"YESTERDAY":return U.ranges.yesterday();case"TOMORROW":return U.ranges.tomorrow();case"THISWEEK":return U.ranges.currentWeek();case"THISMONTH":return U.ranges.currentMonth();case"THISQUARTER":return U.ranges.currentQuarter();case"THISYEAR":return U.ranges.currentYear();case"LASTWEEK":return U.ranges.lastWeek();case"LASTMONTH":return U.ranges.lastMonth();case"LASTQUARTER":return U.ranges.lastQuarter();case"LASTYEAR":return U.ranges.lastYear();case"NEXTWEEK":return U.ranges.nextWeek();case"NEXTMONTH":return U.ranges.nextMonth();case"NEXTQUARTER":return U.ranges.nextQuarter();case"NEXTYEAR":return U.ranges.nextYear();case"LASTDAYS":return U.ranges.lastDays(p);case"LASTWEEKS":return U.ranges.lastWeeks(p);case"LASTMONTHS":return U.ranges.lastMonths(p);case"LASTQUARTERS":return U.ranges.lastQuarters(p);case"LASTYEARS":return U.ranges.lastYears(p);case"NEXTDAYS":return U.ranges.nextDays(p);case"NEXTWEEKS":return U.ranges.nextWeeks(p);case"NEXTMONTHS":return U.ranges.nextMonths(p);case"NEXTQUARTERS":return U.ranges.nextQuarters(p);case"NEXTYEARS":return U.ranges.nextYears(p);case"FROM":return[v.values[0],v.values[0]];case"TO":return[v.values[0],v.values[0]];case"YEARTODATE":return U.ranges.yearToDate();case"DATETOYEAR":return U.ranges.dateToYear();case"TODAYFROMTO":if(v.values.length!==2){return[];}var x=v.values[0];var y=v.values[1];var i=x>=0?U.ranges.lastDays(x)[0]:U.ranges.nextDays(-x)[1];var q=y>=0?U.ranges.nextDays(y)[1]:U.ranges.lastDays(-y)[0];if(i.oDate.getTime()>q.oDate.getTime()){q=[i,i=q][0];}return[U.resetStartTime(i),U.resetEndTime(q)];case"QUARTER1":return U.ranges.quarter(1);case"QUARTER2":return U.ranges.quarter(2);case"QUARTER3":return U.ranges.quarter(3);case"QUARTER4":return U.ranges.quarter(4);default:return[];}};e.prototype.enhanceFormattedValue=function(){switch(this.getKey()){case"TODAY":case"YESTERDAY":case"TOMORROW":case"THISWEEK":case"THISMONTH":case"THISQUARTER":case"THISYEAR":case"LASTWEEK":case"LASTMONTH":case"LASTQUARTER":case"LASTYEAR":case"NEXTWEEK":case"NEXTMONTH":case"NEXTQUARTER":case"NEXTYEAR":case"YEARTODATE":case"DATETOYEAR":case"QUARTER1":case"QUARTER2":case"QUARTER3":case"QUARTER4":return true;default:return false;}};function m(o){return new R({text:o});}return e;});
