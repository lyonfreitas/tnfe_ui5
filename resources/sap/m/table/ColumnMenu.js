/*!
 * OpenUI5
 * (c) Copyright 2009-2021 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/ResponsivePopover","sap/m/List","sap/m/StandardListItem","sap/m/Button","sap/m/Title","sap/m/VBox","sap/m/Toolbar","sap/m/OverflowToolbar","sap/m/ToolbarSpacer","sap/m/ScrollContainer","sap/m/table/ColumnMenuRenderer","sap/m/library","sap/ui/core/Control","sap/ui/core/Core","sap/ui/thirdparty/jquery","sap/base/strings/capitalize","sap/m/p13n/AbstractContainerItem","sap/ui/core/Element","sap/m/p13n/Container"],function(R,L,S,B,T,V,a,O,b,c,C,l,d,e,q,f,A,E,g){"use strict";var h=d.extend("sap.m.table.ColumnMenu",{metadata:{library:"sap.m",aggregations:{quickActions:{type:"sap.m.table.QuickActionBase"},items:{type:"sap.m.table.ItemBase"},_quickActions:{type:"sap.m.table.QuickActionBase",visibility:"hidden"},_items:{type:"sap.m.table.ItemBase",visibility:"hidden"}}}});var D="$default";h.prototype.applySettings=function(s){if(s){this._addAllToPrivateAggregation(s,"_quickActions");this._addAllToPrivateAggregation(s,"_items");}d.prototype.applySettings.apply(this,arguments);};h.prototype.openBy=function(o){if(!this._oPopover){this._createPopover();}if(!this._oItemsContainer){this._initItemsContainer();}this._oPopover.openBy(o);};h.prototype.close=function(){this._previousView=null;if(this._oPopover){this._oPopover.close();}};h.prototype.exit=function(){d.prototype.exit.apply(this,arguments);if(this._oPopover){delete this._oPopover;}if(this._oItemsContainer){delete this._oItemsContainer;}};h.prototype._addAllToPrivateAggregation=function(s,j){if(s[j]){s[j].forEach(function(I){this.addAggregation(j,I);}.bind(this));delete s[j];}};h.prototype._createPopover=function(){if(!this._oPopover){this._oPopover=new R({showArrow:false,showHeader:false,placement:l.PlacementType.Bottom,content:new i({control:this,height:true}),contentWidth:"500px",horizontalScrolling:false,verticalScrolling:false});this.addDependent(this._oPopover);this._oPopover.attachAfterClose(function(){this.close();}.bind(this));this._focusDelegate={"onAfterRendering":this._focusItem};this._oPopover.addEventDelegate(this._focusDelegate,this);if(this.getItems().length==0&&!this.getAggregation("_items")){this._oPopover.attachAfterOpen(this._focusInitialQuickAction.bind(this));}}return this._oPopover;};h.prototype._initItemsContainer=function(){var j=(this.getAggregation("_items")||[]).reduce(function(I,o){return I.concat(o.getEffectiveItems());},[]);var k=this.getItems().reduce(function(I,o){return I.concat(o.getEffectiveItems());},[]);if(!this._oItemsContainer){this._createItemsContainer();}j.forEach(function(o,I){this._addView(o);I==0&&this._oItemsContainer.addSeparator();}.bind(this));k.forEach(function(o,I){this._addView(o);I==0&&this._oItemsContainer.addSeparator();}.bind(this));};var i=d.extend("sap.m.table.AssociativeControl",{metadata:{"final":true,properties:{height:{type:"boolean",defaultValue:false}},associations:{control:{type:"sap.ui.core.Control"}}},renderer:{apiVersion:2,render:function(r,o){r.openStart("div",o);o.getHeight()&&r.style("height","100%");r.openEnd();r.renderControl(sap.ui.getCore().byId(o.getControl()));r.close("div");}}});h.prototype._addView=function(o){var I=new A({content:new i({control:o.getContent(),height:true}),key:o.getId(),text:o.getLabel(),icon:o.getIcon()});this._oItemsContainer.addView(I);this._setItemVisibility(o,o.getVisible());};h.prototype._createItemsContainer=function(){var o=this;this._oBtnCancel=new B({text:this._getResourceText("table.COLUMNMENU_CANCEL"),press:function(){var k=o._oItemsContainer.getCurrentViewKey();if(o._fireEvent(e.byId(k),"cancel")){o.close();o.exit();}}});this._oBtnOk=new B({text:this._getResourceText("table.COLUMNMENU_CONFIRM"),press:function(){var k=o._oItemsContainer.getCurrentViewKey();if(o._fireEvent(e.byId(k),"confirm")){o.close();}}});o._oItemsContainer=new g({listLayout:true,defaultView:D,footer:new a({content:[new b(),this._oBtnOk,this._oBtnCancel]}),beforeViewSwitch:function(j){var p=j.getParameters();if(p.target!=="$default"){var k=o._oItemsContainer.getView(p.target);var m=o._getItemFromContainerItem(k);if(m&&m.firePress&&!o._fireEvent(m,"press")){j.preventDefault();return;}}},afterViewSwitch:function(j){var p=j.getParameters();this.oLayout.setShowFooter(p.target!=="$default");o._previousView=p.source;if(p.target!=="$default"){var k=o._oItemsContainer.getView(p.target);if(k){var I=o._getItemFromContainerItem(k);o._updateButtonState(I);}else{var k=o._oItemsContainer.getView(p.target);var I=o._getItemFromContainerItem(k);I&&I.focus();this._oPopover&&this._oPopover.invalidate();}}}});o._oItemsContainer.getHeader().addContentRight(new B({text:this._getResourceText("table.COLUMNMENU_RESET"),press:function(){o._fireEvent(e.byId(o._oItemsContainer.getCurrentViewKey()),"reset",false);}}));this._oPopover.addDependent(o._oItemsContainer);o.addDependent(o._oItemsContainer);};h.prototype._fireEvent=function(o,s,j){var H=o["on"+f(s)];if(j!==false){var k=q.Event(s);H.call(o,k);return!k.isDefaultPrevented();}else{H.call(o);return true;}};h.prototype._getResourceText=function(t,v){this.oResourceBundle=this.oResourceBundle?this.oResourceBundle:sap.ui.getCore().getLibraryResourceBundle("sap.m");return t?this.oResourceBundle.getText(t,v):this.oResourceBundle;};h.prototype._getItemFromContainerItem=function(o){var I=this.getAggregation("_items")&&this.getAggregation("_items").find(function(j){return j.getId()==o.getKey();});if(!I){I=this.getAggregation("items")&&this.getAggregation("items").find(function(j){return j.getId()==o.getKey();});}return I;};h.prototype._updateButtonState=function(I){this._oItemsContainer.getHeader().getContentRight()[0].setEnabled(I.getButtonSettings()["reset"]["enabled"]);this._oItemsContainer.getHeader().getContentRight()[0].setVisible(I.getButtonSettings()["reset"]["visible"]);this._oBtnOk.setVisible(I.getButtonSettings()["confirm"]["visible"]);this._oBtnCancel.setVisible(I.getButtonSettings()["cancel"]["visible"]);};h.prototype._focusItem=function(){if(this._previousView==D){this._oItemsContainer._getNavBackBtn().focus();}else{var I=this._oItemsContainer._getNavigationList().getItems().find(function(I){return I.getVisible()&&I._key===this._previousView;}.bind(this));I&&I.focus();}};h.prototype._focusInitialQuickAction=function(){if(this.getItems().length==0&&!this.getAggregation("_items")){var Q=[];if(this.getAggregation("_quickActions")){Q=this.getAggregation("_quickActions")[0].getEffectiveQuickActions();}else if(this.getQuickActions().length>0){Q=this.getQuickActions()[0].getEffectiveQuickActions();}Q.length>0&&Q[0].getContent().focus();}};h.prototype._setItemVisibility=function(I,v){var o=this._oItemsContainer._getNavigationList().getItems();var j=o.find(function(j){return j._key==I.getId();});j&&j.setVisible(v);};return h;});
