/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/mdc/odata/v4/TableDelegate","sap/ui/core/Core","sap/ui/mdc/util/FilterUtil","sap/ui/mdc/odata/v4/util/DelegateUtil","sap/ui/mdc/odata/v4/FilterBarDelegate","sap/ui/mdc/odata/v4/ODataMetaModelUtil","sap/ui/mdc/odata/v4/TypeUtil","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/base/Log","sap/fe/macros/DelegateUtil","sap/fe/core/helpers/ModelHelper","sap/fe/core/CommonUtils"],function(T,C,F,D,a,O,b,c,d,L,M,e,f){"use strict";var g=Object.assign({},T);g.fetchProperties=function(t){var m=this._getModel(t);var p;if(!m){p=new Promise(function(r){t.attachModelContextChange({resolver:r},o,this);}.bind(this)).then(function(m){return this._createPropertyInfos(t,m);}.bind(this));}else{p=this._createPropertyInfos(t,m);}return p.then(function(P){if(t.data){t.data("$tablePropertyInfo",P);}return P;});};function o(E,h){var t=E.getSource();var m=this._getModel(t);if(m){t.detachModelContextChange(o);h.resolver(m);}}g._createPropertyInfos=function(t,m){var h=t.getDelegate().payload;var p=[];var E="/"+h.collectionName;var i=m.getMetaModel();return i.requestObject(E+"@").then(function(j){var s=j["@Org.OData.Capabilities.V1.SortRestrictions"]||{};var S=O.getSortRestrictionsInfo(s);var k=j["@Org.OData.Capabilities.V1.FilterRestrictions"];var l=O.getFilterRestrictionsInfo(k);var n=M.getCustomData(t,"columns");n.customData.forEach(function(q){p.push({name:q.path,path:q.path,label:q.label,sortable:S[q.path]?S[q.path].sortable:q.sortable,filterable:l[q.path]?l[q.path].filterable:q.filterable,typeConfig:M.isTypeFilterable(q.$Type)?t.getTypeUtil().getTypeConfig(q.$Type):undefined,maxConditions:O.isMultiValueFilterExpression(l.propertyInfo[q.path])?-1:1});});return p;});};g.updateBindingInfo=function(m,h,B){T.updateBindingInfo.apply(this,[m,h,B]);if(!m){return;}if(h&&B){B.path=B.path||h.collectionPath||"/"+h.collectionName;B.model=B.model||h.model;}if(!B){B={};}var i=C.byId(m.getFilter()),j=m.isFilteringEnabled(),k;var I,l;var n=[];var t=m.data("$tablePropertyInfo");if(j){k=m.getConditions();I=F.getFilterInfo(m,k,t);if(I.filters){n.push(I.filters);}}if(i){k=i.getConditions();if(k){var p=D.getParameterNames(i);l=F.getFilterInfo(i,k,t,p);if(l.filters){n.push(l.filters);}var P=D.getParametersInfo(i,k);if(P){B.path=P;}}B.parameters.$search=f.normalizeSearchTerm(i.getSearch())||undefined;}B.parameters.$select=t.reduce(function(q,r){if(r.path&&r.path.indexOf("/")===-1){q=q?q+","+r.path:r.path;}return q;},"");if(e.isDraftSupported(m.getModel().getMetaModel(),B.path)){n.push(new c("IsActiveEntity",d.EQ,true));}B.filters=new c(n,true);};g.getFilterDelegate=function(){return a;};g.getTypeUtil=function(p){return b;};g._getModel=function(t){var m=t.getDelegate().payload;return t.getModel(m.model);};return g;});
