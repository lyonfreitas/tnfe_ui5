/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["sap/fe/core/helpers/ClassSupport","sap/fe/core/helpers/PasteHelper","sap/m/MessageBox","sap/ui/Device","sap/base/Log","./MacroAPI","sap/fe/macros/massedit/MassEditHandler","sap/fe/macros/DelegateUtil"],function(C,P,M,D,L,a,b,c){"use strict";var _,d,f,g,h,j,k,l,m,n,q,r,s,t,u,v,w,x,y,z,A,B,E,F,G,H,I,J,K,N,O,Q,R,S,T;var U=C.Event;var V=C.Property;var W=C.MacroContext;var X=C.EventHandler;var Y=C.APIClass;function Z(e,p,i,o){if(!i)return;Object.defineProperty(e,p,{enumerable:i.enumerable,configurable:i.configurable,writable:i.writable,value:i.initializer?i.initializer.call(o):void 0});}function $(i,e){if(!(i instanceof e)){throw new TypeError("Cannot call a class as a function");}}function a1(e,p){for(var i=0;i<p.length;i++){var o=p[i];o.enumerable=o.enumerable||false;o.configurable=true;if("value"in o)o.writable=true;Object.defineProperty(e,o.key,o);}}function b1(e,p,i){if(p)a1(e.prototype,p);if(i)a1(e,i);return e;}function c1(e,i){if(typeof i!=="function"&&i!==null){throw new TypeError("Super expression must either be null or a function");}e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:true,configurable:true}});if(i)d1(e,i);}function d1(o,p){d1=Object.setPrototypeOf||function d1(o,p){o.__proto__=p;return o;};return d1(o,p);}function e1(e){var i=h1();return function o1(){var o=i1(e),p;if(i){var n1=i1(this).constructor;p=Reflect.construct(o,arguments,n1);}else{p=o.apply(this,arguments);}return f1(this,p);};}function f1(e,i){if(i&&(typeof i==="object"||typeof i==="function")){return i;}return g1(e);}function g1(e){if(e===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return e;}function h1(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}function i1(o){i1=Object.setPrototypeOf?Object.getPrototypeOf:function i1(o){return o.__proto__||Object.getPrototypeOf(o);};return i1(o);}function j1(o,e,i){if(e in o){Object.defineProperty(o,e,{value:i,enumerable:true,configurable:true,writable:true});}else{o[e]=i;}return o;}function k1(e,p,i,o,n1){var o1={};Object.keys(o).forEach(function(p1){o1[p1]=o[p1];});o1.enumerable=!!o1.enumerable;o1.configurable=!!o1.configurable;if('value'in o1||o1.initializer){o1.writable=true;}o1=i.slice().reverse().reduce(function(o1,p1){return p1(e,p,o1)||o1;},o1);if(n1&&o1.initializer!==void 0){o1.value=o1.initializer?o1.initializer.call(n1):void 0;o1.initializer=undefined;}if(o1.initializer===void 0){Object.defineProperty(e,p,o1);o1=null;}return o1;}function l1(e,i){throw new Error('Decorating class property failed. Please ensure that '+'proposal-class-properties is enabled and runs after the decorators transform.');}var m1=(_=Y("sap.fe.macros.TableAPI"),d=W(),f=V({type:"boolean"}),g=V({type:"string"}),h=V({type:"boolean",defaultValue:false}),j=V({type:"string",defaultValue:"ResponsiveTable"}),k=V({type:"boolean",defaultValue:true}),l=V({type:"boolean",defaultValue:false}),m=V({type:"boolean",defaultValue:false}),n=V({type:"string"}),q=V({type:"string"}),r=V({type:"boolean",defaultValue:false}),s=V({type:"boolean",defaultValue:true}),t=V({type:"boolean|string",defaultValue:true}),u=V({type:"string"}),v=V({type:"boolean"}),_(w=(x=function(e){c1(m1,e);var i=e1(m1);function m1(){var o;$(this,m1);for(var p=arguments.length,n1=new Array(p),o1=0;o1<p;o1++){n1[o1]=arguments[o1];}o=i.call.apply(i,[this].concat(n1));Z(g1(o),"tableDefinition",y,g1(o));Z(g1(o),"readOnly",z,g1(o));Z(g1(o),"id",A,g1(o));Z(g1(o),"busy",B,g1(o));Z(g1(o),"type",E,g1(o));Z(g1(o),"enableExport",F,g1(o));Z(g1(o),"enablePaste",G,g1(o));Z(g1(o),"enableFullScreen",H,g1(o));Z(g1(o),"selectionMode",I,g1(o));Z(g1(o),"header",J,g1(o));Z(g1(o),"enableAutoColumnWidth",K,g1(o));Z(g1(o),"headerVisible",N,g1(o));Z(g1(o),"rowPress",O,g1(o));Z(g1(o),"stateChanged",Q,g1(o));Z(g1(o),"personalization",R,g1(o));Z(g1(o),"variantManagement",S,g1(o));Z(g1(o),"enableDataStateFilter",T,g1(o));return o;}b1(m1,[{key:"onTableRowPress",value:function p1(o,p,n1,o1){if(n1&&n1.isA("sap.ui.model.odata.v4.Context")&&typeof n1.getProperty("@$ui5.node.isExpanded")==="boolean"){return false;}else{p._routing.navigateForwardToContext(n1,o1);}}},{key:"onInternalDataReceived",value:function p(o){if(o.getParameter("error")){this.getController().messageHandler.showMessageDialog();}}},{key:"onPaste",value:function s1(o,p){var n1=this;if(!this.tableDefinition.control.enablePaste||!this.getModel("ui").getProperty("/isEditable")){return;}var o1=o.getParameter("data"),p1=o.getSource(),q1=p1.data()["enablePaste"];var r1;if(q1===true||q1==="true"){P.parseDataForTablePaste(o1,p1).then(function(t1){if(t1&&t1.length>0){return p._editFlow.createMultipleDocuments(p1.getRowBinding(),t1,n1.tableDefinition.control.createAtEnd,true);}}).catch(function(t1){L.error("Error while pasting data",t1);});}else{r1=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");M.error(r1.getText("T_OP_CONTROLLER_SAPFE_PASTE_DISABLED_MESSAGE"),{title:r1.getText("C_COMMON_SAPFE_ERROR")});}}},{key:"onPasteButtonPressed",value:function q1(){var o=this;var p=sap.ui.getCore().getLibraryResourceBundle("sap.fe.templates"),n1=D.os.name,o1=D.system;var p1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");if(o1.phone||o1.tablet&&!o1.combi){p1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_TOUCH_DEVICE");}else if(o1.desktop){switch(n1){case"win":p1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_WINDOWS_DESKTOP");break;case"mac":p1=p.getText("T_OP_CONTROLLER_TABLE_PASTE_BUTTON_ACTION_MESSAGE_IOS_DESKTOP");break;}}M.information(p1,{onClose:function(){if(o.content){var r1;(r1=o.content.getAggregation("_content"))===null||r1===void 0?void 0:r1.applyFocusInfo({preventScroll:true});}}});}},{key:"onBeforeExport",value:function s1(o){var p;var n1=o.getParameters().userExportSettings.splitCells,o1=sap.ui.getCore().getConfiguration().getRTL(),p1=o.getSource(),q1=(p=o.getParameters().exportSettings.workbook)===null||p===void 0?void 0:p.columns,r1=this.tableDefinition.columns;m1.updateExportSettings(q1,r1,p1,n1,o1);}},{key:"onDataStateChange",value:function p1(o){var p=o.getSource();var n1=o.getParameter("filteredMessages");if(n1){var o1=p.getModel("internal");o1.setProperty("filteredMessages",n1,p.getBindingContext("internal"));}}},{key:"onMassEditButtonPressed",value:function o1(o,p){var n1=this.content;b.openMassEditDialog(n1,p);}}],[{key:"shouldFilterDataStateMessage",value:function o1(o,p){var n1=p.getParent();while(!n1.isA("sap.fe.macros.TableAPI")){n1=n1.getParent();}return n1.tableDefinition.enableDataStateFilter;}},{key:"updateExportSettings",value:function q1(o,p,n1,o1,p1){o.forEach(function(r1){var s1=[];p===null||p===void 0?void 0:p.forEach(function(t1){var u1=t1;if(o1){var v1=p.some(function(t1){return t1.unit===r1.property;});var w1=m1._getFieldGroupExportLabel(r1,u1,n1);if(w1){s1.unshift(w1);}var x1=m1._getDataFieldDescriptionLabel(r1,u1,n1,v1);if(x1){s1.unshift(x1);}if(u1.isDataPointFakeTargetProperty&&u1.relativePath===r1.property){r1.property=[r1.property];}}if(u1.exportContactProperty&&t1.propertyInfos){var y1,z1,A1,B1;if(((y1=t1.propertyInfos)===null||y1===void 0?void 0:y1.length)===1&&((z1=t1.propertyInfos)===null||z1===void 0?void 0:z1.toString())===r1.property.toString()){r1.property=u1.exportContactProperty;r1.label=u1.label;}else if(((A1=t1.propertyInfos)===null||A1===void 0?void 0:A1.length)>1&&(B1=u1.propertyInfos)!==null&&B1!==void 0&&B1.some(function(D1){return r1.property.includes(D1);})&&Array.isArray(r1.property)){var C1;r1.property=(C1=r1.property)===null||C1===void 0?void 0:C1.map(function(D1){var E1;return(E1=u1.propertyInfos)!==null&&E1!==void 0&&E1.some(function(F1){return F1===D1;})?u1.exportContactProperty:D1;});}}});s1.push(c.getLocalizedText(r1.label,n1));if(s1.length>1){s1=s1.filter(function(t1,u1){if(s1.indexOf(t1)==u1){return t1;}});}if(p1){s1.reverse();}r1.label=s1.join(" - ");});return o;}},{key:"_getFieldGroupExportLabel",value:function t1(o,p,n1){var o1,p1,q1;if((o.columnId.indexOf("::FieldGroup::")!==-1||(o1=p.exportSettings)!==null&&o1!==void 0&&o1.fieldLabel&&o.columnId.indexOf("__column")!==-1)&&((p1=p.propertyInfos)!==null&&p1!==void 0&&p1.includes(o.property)||(q1=p.propertyInfos)!==null&&q1!==void 0&&q1.includes("Property::"+o.property))){var r1;var s1=((r1=p.exportSettings)===null||r1===void 0?void 0:r1.fieldLabel)||p.label;return c.getLocalizedText(s1,n1);}}},{key:"_getDataFieldDescriptionLabel",value:function t1(o,p,n1,o1){var p1,q1,r1,s1;if(p.propertyInfos&&((p1=p.propertyInfos)===null||p1===void 0?void 0:p1.length)>1&&!o1&&((q1=p.propertyInfos)!==null&&q1!==void 0&&q1.includes(o.property)||(r1=p.propertyInfos)!==null&&r1!==void 0&&r1.includes("Property::"+o.property))&&((s1=p.relativePath)===null||s1===void 0?void 0:s1.indexOf("@com.sap.vocabularies.UI.v1.FieldGroup"))===-1){return c.getLocalizedText(p.label,n1);}}}]);return m1;}(a),(y=k1(x.prototype,"tableDefinition",[d],{configurable:true,enumerable:true,writable:true,initializer:null}),z=k1(x.prototype,"readOnly",[f],{configurable:true,enumerable:true,writable:true,initializer:null}),A=k1(x.prototype,"id",[g],{configurable:true,enumerable:true,writable:true,initializer:null}),B=k1(x.prototype,"busy",[h],{configurable:true,enumerable:true,writable:true,initializer:null}),E=k1(x.prototype,"type",[j],{configurable:true,enumerable:true,writable:true,initializer:null}),F=k1(x.prototype,"enableExport",[k],{configurable:true,enumerable:true,writable:true,initializer:null}),G=k1(x.prototype,"enablePaste",[l],{configurable:true,enumerable:true,writable:true,initializer:null}),H=k1(x.prototype,"enableFullScreen",[m],{configurable:true,enumerable:true,writable:true,initializer:null}),I=k1(x.prototype,"selectionMode",[n],{configurable:true,enumerable:true,writable:true,initializer:null}),J=k1(x.prototype,"header",[q],{configurable:true,enumerable:true,writable:true,initializer:null}),K=k1(x.prototype,"enableAutoColumnWidth",[r],{configurable:true,enumerable:true,writable:true,initializer:null}),N=k1(x.prototype,"headerVisible",[s],{configurable:true,enumerable:true,writable:true,initializer:null}),O=k1(x.prototype,"rowPress",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),Q=k1(x.prototype,"stateChanged",[U],{configurable:true,enumerable:true,writable:true,initializer:null}),R=k1(x.prototype,"personalization",[t],{configurable:true,enumerable:true,writable:true,initializer:null}),S=k1(x.prototype,"variantManagement",[u],{configurable:true,enumerable:true,writable:true,initializer:null}),T=k1(x.prototype,"enableDataStateFilter",[v],{configurable:true,enumerable:true,writable:true,initializer:null}),k1(x.prototype,"onTableRowPress",[X],Object.getOwnPropertyDescriptor(x.prototype,"onTableRowPress"),x.prototype),k1(x.prototype,"onInternalDataReceived",[X],Object.getOwnPropertyDescriptor(x.prototype,"onInternalDataReceived"),x.prototype),k1(x.prototype,"onPaste",[X],Object.getOwnPropertyDescriptor(x.prototype,"onPaste"),x.prototype),k1(x.prototype,"onPasteButtonPressed",[X],Object.getOwnPropertyDescriptor(x.prototype,"onPasteButtonPressed"),x.prototype),k1(x.prototype,"onBeforeExport",[X],Object.getOwnPropertyDescriptor(x.prototype,"onBeforeExport"),x.prototype),k1(x.prototype,"onDataStateChange",[X],Object.getOwnPropertyDescriptor(x.prototype,"onDataStateChange"),x.prototype),k1(x.prototype,"onMassEditButtonPressed",[X],Object.getOwnPropertyDescriptor(x.prototype,"onMassEditButtonPressed"),x.prototype)),x))||w);return m1;},false);
