/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
        (c) Copyright 2009-2021 SAP SE. All rights reserved
    
 */
sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/mvc/OverrideExecution","sap/fe/core/actions/messageHandling","sap/fe/core/CommonUtils","sap/fe/core/controllerextensions/ControllerExtensionMetadata"],function(C,O,m,a,b){"use strict";return C.extend("sap.fe.core.controllerextensions.MessageHandler",{metadata:{methods:{showMessageDialog:{"public":true,"final":true},getShowBoundMessagesInMessageDialog:{"public":false,"final":false,overrideExecution:O.Instead}}},getShowBoundMessagesInMessageDialog:function(){return true;},showMessageDialog:function(p){var c=p&&p.customMessages?p.customMessages:undefined,o=this.base.getView().getBindingContext("internal");if(p&&p.isActionParameterDialogOpen&&o){o.setProperty("isActionParameterDialogOpen",true);}var s=this.getShowBoundMessagesInMessageDialog();var B=p&&p.context?p.context:this.getView().getBindingContext();var e=p&&p.bHasEtagMessage;if(o){o.setProperty("isActionParameterDialogOpen",false);}return new Promise(function(r,d){setTimeout(function(){m.showUnboundMessages(c,B,e,s).then(r).catch(d);},0);});},removeTransitionMessages:function(k){if(!k){m.removeBoundTransitionMessages();}m.removeUnboundTransitionMessages();},_checkNavigationToMessagePage:function(p){var u=m.getMessages(),s=this.getShowBoundMessagesInMessageDialog(),B=s?m.getMessages(true,true):[],c=p&&p.customMessages?p.customMessages:[],i=a.isStickyEditMode(this.base.getView()),M;if(!i&&!B.length&&!c.length&&u.length===1){var o=u[0],t=o.getTechnicalDetails();var r;if(t&&t.httpStatus===503){if(t.retryAfter){var S=this._getSecondsBeforeRetryAfter(t.retryAfter);if(S>120){r=m.getRetryAfterMessage(o);M={description:r?r+" "+o.getMessage():o.getMessage(),navigateBackToOrigin:true};}}else{r=m.getRetryAfterMessage(o);M={description:r?r+" "+o.getMessage():o.getMessage(),navigateBackToOrigin:true};}}}return M;},_getSecondsBeforeRetryAfter:function(r){var c=new Date(),i=c.getTime(),R=r.getTime(),s=(R-i)/1000;return s;},showMessages:function(p){var M=this._checkNavigationToMessagePage(p);if(M){p&&p.messagePageNavigationCallback&&p.messagePageNavigationCallback();M.handleShellBack=true;this.removeTransitionMessages();var r=sap.ui.getCore().getLibraryResourceBundle("sap.fe.core");if(this.base._routing){return new Promise(function(c,d){setTimeout(function(){this.base._routing.navigateToMessagePage(r.getText("C_MESSAGE_HANDLING_SAPFE_503_TITLE"),M).then(c).catch(d);}.bind(this),0);}.bind(this));}}else{return this.showMessageDialog(p);}}},b);});
