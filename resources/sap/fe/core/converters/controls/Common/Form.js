/*!
 * SAP UI development toolkit for HTML5 (SAPUI5)
 *      (c) Copyright 2009-2021 SAP SE. All rights reserved
 */
sap.ui.define(["../../helpers/ConfigurableObject","../../helpers/ID","../../helpers/Key","../../ManifestSettings","sap/fe/core/converters/annotations/DataField","sap/fe/core/templating/DataModelPathHelper","../../../helpers/StableIdHelper"],function(C,I,K,M,D,a,S){"use strict";var _={};var g=S.generate;var b=a.getTargetObjectPath;var c=a.getTargetEntitySetPath;var d=D.getSemanticObjectPath;var A=M.ActionType;var e=K.KeyHelper;var F=I.FormStandardActionButtonID;var f=I.FormID;var P=C.Placement;var h=C.insertCustomElements;function o(i,v){var w=Object.keys(i);if(Object.getOwnPropertySymbols){var x=Object.getOwnPropertySymbols(i);if(v){x=x.filter(function(y){return Object.getOwnPropertyDescriptor(i,y).enumerable;});}w.push.apply(w,x);}return w;}function j(v){for(var i=1;i<arguments.length;i++){var w=arguments[i]!=null?arguments[i]:{};if(i%2){o(Object(w),true).forEach(function(x){k(v,x,w[x]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(v,Object.getOwnPropertyDescriptors(w));}else{o(Object(w)).forEach(function(x){Object.defineProperty(v,x,Object.getOwnPropertyDescriptor(w,x));});}}return v;}function k(i,v,w){if(v in i){Object.defineProperty(i,v,{value:w,enumerable:true,configurable:true,writable:true});}else{i[v]=w;}return i;}var l;(function(l){l["Default"]="Default";l["Annotation"]="Annotation";})(l||(l={}));_.FormElementType=l;function m(){return{textLinesEdit:4};}function n(i,v){var w,x,y,z;return v===false||((w=i.annotations)===null||w===void 0?void 0:(x=w.UI)===null||x===void 0?void 0:x.PartOfPreview)===undefined||((y=i.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:z.PartOfPreview)===true;}function p(i,v){var w=[];var x=v.getEntityTypeAnnotation(i.Target.value);var y=x.annotation;v=x.converterContext;function z(B,E){var G,H,J;var L=d(v,B);if(B.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForAction"&&B.$Type!=="com.sap.vocabularies.UI.v1.DataFieldForIntentBasedNavigation"&&((G=B.annotations)===null||G===void 0?void 0:(H=G.UI)===null||H===void 0?void 0:(J=H.Hidden)===null||J===void 0?void 0:J.valueOf())!==true){w.push({key:e.generateKeyFromDataField(B),type:l.Annotation,annotationPath:v.getEntitySetBasedAnnotationPath(B.fullyQualifiedName)+"/",semanticObjectPath:L,formatOptions:m(),isPartOfPreview:n(B,E)});}}switch(y===null||y===void 0?void 0:y.term){case"com.sap.vocabularies.UI.v1.FieldGroup":y.Data.forEach(function(B){var E,G;return z(B,(E=i.annotations)===null||E===void 0?void 0:(G=E.UI)===null||G===void 0?void 0:G.PartOfPreview);});break;case"com.sap.vocabularies.UI.v1.Identification":y.forEach(function(B){var E,G;return z(B,(E=i.annotations)===null||E===void 0?void 0:(G=E.UI)===null||G===void 0?void 0:G.PartOfPreview);});break;case"com.sap.vocabularies.UI.v1.DataPoint":w.push({key:"DataPoint::"+(y.qualifier?y.qualifier:""),type:l.Annotation,annotationPath:v.getEntitySetBasedAnnotationPath(y.fullyQualifiedName)+"/"});break;case"com.sap.vocabularies.Communication.v1.Contact":w.push({key:"Contact::"+(y.qualifier?y.qualifier:""),type:l.Annotation,annotationPath:v.getEntitySetBasedAnnotationPath(y.fullyQualifiedName)+"/"});break;default:break;}return w;}function q(i,v){var w=v.getManifestWrapper();var x=w.getFormContainer(i.Target.value);var y={};if(x!==null&&x!==void 0&&x.fields){Object.keys(x===null||x===void 0?void 0:x.fields).forEach(function(z){y[z]={key:z,id:"CustomFormElement::"+z,type:l.Default,template:x.fields[z].template,label:x.fields[z].label,position:x.fields[z].position||{placement:P.After},formatOptions:j(j({},m()),x.fields[z].formatOptions)};});}return y;}_.getFormElementsFromManifest=q;function r(i,v,w){var x,y,z;var B=g([{Facet:i}]);var E="/"+i.fullyQualifiedName;var G=v.getEntityTypeAnnotation(i.Target.value);var H;if(G.converterContext.getEntitySet()&&G.converterContext.getEntitySet()!==v.getEntitySet()){H=c(G.converterContext.getDataModelObjectPath());}else if(((x=G.converterContext.getDataModelObjectPath().targetObject)===null||x===void 0?void 0:x.containsTarget)===true){H=b(G.converterContext.getDataModelObjectPath(),false);}var J=h(p(i,v),q(i,v),{formatOptions:"overwrite"});w=w!==undefined?w.filter(function(N){return N.facetName==i.fullyQualifiedName;}):[];if(w.length===0){w=undefined;}var L={id:F(B,"ShowHideDetails"),key:"StandardAction::ShowHideDetails",text:"{sap.fe.i18n>T_COMMON_OBJECT_PAGE_SHOW_FORM_CONTAINER_DETAILS}",type:A.ShowFormDetails,press:"FormContainerRuntime.toggleDetails"};if(((y=i.annotations)===null||y===void 0?void 0:(z=y.UI)===null||z===void 0?void 0:z.PartOfPreview)!==false&&J.some(function(N){return N.isPartOfPreview===false;})){if(w!==undefined){w.push(L);}else{w=[L];}}return{id:B,formElements:J,annotationPath:E,entitySet:H,actions:w};}_.getFormContainer=r;function s(i,v,w){var x;var y=[];(x=i.Facets)===null||x===void 0?void 0:x.forEach(function(z){if(z.$Type==="com.sap.vocabularies.UI.v1.CollectionFacet"){return;}y.push(r(z,v,w));});return y;}function t(i){return i.$Type==="com.sap.vocabularies.UI.v1.ReferenceFacet";}_.isReferenceFacet=t;function u(i,v,w){var x,y,z;switch(i.$Type){case"com.sap.vocabularies.UI.v1.CollectionFacet":var B={id:f({Facet:i}),useFormContainerLabels:true,hasFacetsNotPartOfPreview:i.Facets.some(function(G){var H,J,L;return((H=G.annotations)===null||H===void 0?void 0:(J=H.UI)===null||J===void 0?void 0:(L=J.PartOfPreview)===null||L===void 0?void 0:L.valueOf())===false;}),formContainers:s(i,v,w)};return B;case"com.sap.vocabularies.UI.v1.ReferenceFacet":var E={id:f({Facet:i}),useFormContainerLabels:false,hasFacetsNotPartOfPreview:((x=i.annotations)===null||x===void 0?void 0:(y=x.UI)===null||y===void 0?void 0:(z=y.PartOfPreview)===null||z===void 0?void 0:z.valueOf())===false,formContainers:[r(i,v,w)]};return E;default:throw new Error("Cannot create form based on ReferenceURLFacet");}}_.createFormDefinition=u;return _;},false);
