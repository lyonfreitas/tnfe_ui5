// Copyright (c) 2009-2020 SAP SE, All Rights Reserved
sap.ui.define(["sap/base/Log","sap/base/security/encodeXML","sap/base/util/deepEqual","sap/base/util/uid","sap/base/util/UriParameters","sap/m/MessagePopover","sap/m/Text","sap/ui/core/Component","sap/ui/core/ComponentContainer","sap/ui/core/Control","sap/ui/core/Icon","sap/ui/core/mvc/View","sap/ui/core/routing/History","sap/ui/Device","sap/ui/thirdparty/jquery","sap/ui/thirdparty/URI","sap/ushell/ApplicationType","sap/ushell/Config","sap/ushell/EventHub","sap/ushell/library","sap/ushell/resources","sap/ushell/System","sap/ushell/User","sap/ushell/utils","sap/ushell/utils/UrlParsing"],function(L,a,d,g,U,M,T,C,b,c,I,V,H,D,q,f,A,h,E,u,r,S,j,k,o){"use strict";var P="sap.ushell.components.container.",s=P+"ApplicationContainer",l="sap.ushell.Container.dirtyState.",m="autoplay;battery;camera;display-capture;geolocation;gyroscope;magnetometer;microphone;midi;clipboard-write;clipboard-read;fullscreen;",n,t,v,w=false,K=false,x=[],y=0;var z=["sap-ach","sap-fiori-id","sap-hide-intent-link","sap-priority","sap-tag","sap-ui-app-id-hint","sap-ui-debug","sap-ui-fl-control-variant-id","sap-ui-fl-max-layer","sap-ui-tech-hint","sap-ui2-tcode","sap-ui2-wd-app-id","sap-ui2-wd-conf-id","sap-ushell-cdm-site-url","sap-ushell-navmode","sap-ushell-next-navmode","sap-ushell-url","sap-app-origin-hint"];function B(e){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(i){i.isUrlSupported(e.url).done(function(){e.promise.resolve({allowed:true,id:e.id});}).fail(function(){e.promise.resolve({allowed:false,id:e.id});});});}function F(e){var i={asyncURLHandler:u1.prototype._adaptIsUrlSupportedResultForMessagePopover};if(M&&M.setDefaultHandlers){M.setDefaultHandlers(i);}E.emit("StepDone",e.stepName);}E.once("initMessagePopover").do(F);n=new k.Map();function G(e){return n.get(e.getId());}function J(){return t;}function N(e){var p=new U(e).mParams,i=p["sap-xapp-state"],v1;delete p["sap-xapp-state"];v1={startupParameters:p};if(i){v1["sap-xapp-state"]=i;}return v1;}function O(e,i){return r.i18n.getText(e,i);}function Q(){return new I({size:"2rem",src:"sap-icon://error",tooltip:u1.prototype._getTranslatedText("an_error_has_occured")});}function R(e){var i=e.getAggregation("child"),p;if(i instanceof b){p=i.getComponentInstance().getMetadata().getName().replace(/\.Component$/,"");L.debug("unloading component "+p,null,s);}e.destroyAggregation("child");}function W(e,i,p){return new Promise(function(v1){var w1,x1,y1,z1,A1,B1={},C1,D1;function E1(I1){I1.setWidth(e.getWidth());I1.setHeight(e.getHeight());I1.addStyleClass("sapUShellApplicationContainer");e.setAggregation("child",I1,true);}w1=i.indexOf("?");if(w1>=0){z1=u1.prototype._getParameterMap(i);B1=z1.startupParameters;i=i.slice(0,w1);}if(i.slice(-1)!=="/"){i+="/";}if(/\.view\.(\w+)$/i.test(p)){y1=/^SAPUI5=(?:([^/]+)\/)?([^/]+)\.view\.(\w+)$/i.exec(p);if(!y1){L.error("Invalid SAPUI5 URL",p,s);v1(u1.prototype._createErrorControl());return;}A1=y1[1];C1=y1[2];D1=y1[3].toUpperCase();if(A1){C1=A1+"."+C1;}else{x1=C1.lastIndexOf(".");if(x1<1){L.error("Missing namespace",p,s);return u1.prototype._createErrorControl();}A1=C1.slice(0,x1);}}else{A1=p.replace(/^SAPUI5=/,"");}var F1={};var G1=A1.replace(/\./g,"/");F1[A1]=i+G1;sap.ui.loader.config({paths:F1});u1.prototype._destroyChild(e);if(C1){if(e.getApplicationConfiguration()){B1.config=e.getApplicationConfiguration();}V.create({id:e.getId()+"-content",type:D1,viewData:B1||{},viewName:C1}).then(function(I1){e.fireEvent("applicationConfiguration");E1(I1);v1(I1);});}else{L.debug("loading component "+A1,null,s);var H1=z1?{startupParameters:z1.startupParameters}:{startupParameters:{}};if(z1&&z1["sap-xapp-state"]){H1["sap-xapp-state"]=z1["sap-xapp-state"];}if(e.getApplicationConfiguration()){H1.config=e.getApplicationConfiguration();}C.create({id:e.getId()+"-component",componentData:H1,name:A1}).then(function(I1){e.fireEvent("applicationConfiguration",{configuration:I1.getMetadata().getConfig()});var J1=new b({id:e.getId()+"-content",component:I1});E1(J1);v1(J1);});}});}function X(e,i){setTimeout(function(){sap.ui.getCore().getEventBus().publish("sap.ushell",e,i);},0);}function Y(e,i,p){var v1=this,w1,x1={oControl:undefined,oPromise:undefined},y1,z1,A1,B1={startupParameters:{}},C1,D1=e.getComponentHandle(),E1,F1;function G1(H1){e.fireEvent("applicationConfiguration",{configuration:H1.getMetadata().getConfig()});z1=new b({id:e.getId()+"-content",component:H1});z1.setHeight(e.getHeight());z1.setWidth(e.getWidth());z1.addStyleClass("sapUShellApplicationContainer");e._disableRouterEventHandler=u1.prototype._disableRouter.bind(v1,H1);sap.ui.getCore().getEventBus().subscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",e._disableRouterEventHandler);e.setAggregation("child",z1,true);sap.ushell.Container.getServiceAsync("PluginManager").then(function(K1){E1=K1.getPluginLoadingPromise("RendererExtensions");F1=E1&&E1.state();if(F1==="pending"){E1.done(function(){u1.prototype._publishExternalEvent("appComponentLoaded",{component:H1});}).fail(function(){u1.prototype._publishExternalEvent("appComponentLoaded",{component:H1});});}if(F1==="resolved"||F1==="rejected"){u1.prototype._publishExternalEvent("appComponentLoaded",{component:H1});}});return z1;}y1=i.indexOf("?");if(y1>=0){A1=u1.prototype._getParameterMap(i);B1={startupParameters:A1.startupParameters};if(A1["sap-xapp-state"]){B1["sap-xapp-state"]=A1["sap-xapp-state"];}i=i.slice(0,y1);}if(e.getApplicationConfiguration()){B1.config=e.getApplicationConfiguration();}if(i.slice(-1)!=="/"){i+="/";}u1.prototype._destroyChild(e);C1={id:e.getId()+"-component",name:p,componentData:B1};L.debug("Creating component instance for "+p,JSON.stringify(C1),s);sap.ui.getCore().getEventBus().publish("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",{name:p});if(D1){var H1=D1.getInstance(C1);x1.oControl=G1(H1);}else{w1=new q.Deferred();var I1={};var J1=p.replace(/\./g,"/");I1[J1]=i;sap.ui.loader.config({paths:I1});L.error("No component handle available for '"+p+"'; fallback to component.load()",null,s);C.create({id:e.getId()+"-component",name:p,manifest:false,componentData:B1}).then(function(H1){w1.resolve(G1(H1));});x1.oPromise=w1.promise();}return x1;}function Z(e){var i;if((e instanceof C)&&(typeof e.getRouter==="function")){i=e.getRouter();if(i&&(typeof i.stop==="function")){L.info("router stopped for instance "+e.getId());i.stop();}}}function $(e){var i=document.createElement("a"),p=new U(e).get("sap-client"),v1;i.href=e;v1=i.protocol+"//"+i.host;return new S({alias:p?v1+"?sap-client="+p:v1,baseUrl:v1,client:p||undefined,platform:"abap"});}function _(e,i){var p=false,v1=e.getDomRef(),w1,x1;if(e.getIframeWithPost()===true&&v1&&v1.getAttribute&&v1.getAttribute("sap-iframe-app")=="true"){v1=q("#"+v1.getAttribute("id")+"-iframe")[0];}if(v1){w1=f(e._getIFrameUrl(v1)||window.location&&window.location.href||"");x1=w1.protocol()+"://"+w1.host();p=(i.source===v1.contentWindow)||(i.origin===x1);}return p;}function a1(e,i,p){var v1=JSON.stringify({type:"request",service:i,request_id:g(),body:{}});L.debug("Sending post message request to origin ' "+p+"': "+v1,null,"sap.ushell.components.container.ApplicationContainer");e.postMessage(v1,p);}function b1(){var i=this.getDomRef();if(!i||i.tagName!=="IFRAME"){if(this.getIframeWithPost()===true&&i&&i.getAttribute&&i.getAttribute("sap-iframe-app")=="true"){return q("#"+i.getAttribute("id")+"-iframe")[0];}return null;}return i;}function c1(i){var e;if(i===undefined){i=this._getIFrame();}if(this.getIframeWithPost()===true){e=q("#"+i.getAttribute("id").replace("-iframe","-form"))[0].action;if(e===undefined&&(new f()).query(true).hasOwnProperty("sap-isolation-enabled")){e=i.src;}}else{e=i.src;}return e;}function d1(e,i){if(e&&!e.getActive()){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(v1)+"' on inactive container '"+e.getId()+"'","Only active containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var p=e.getUi5ComponentName&&e.getUi5ComponentName(),v1=i.data;if(typeof p==="string"){L.debug("Skipping handling of postMessage 'message' event with data '"+JSON.stringify(v1)+"' on container of UI5 application '"+p+"'","Only non UI5 application containers can handle 'message' postMessage event","sap.ushell.components.container.ApplicationContainer");return;}var w1={bApiRegistered:true};v(e,i,w1);u1.prototype._handlePostMessagesForPluginsPostLoading(e,i,w1);}function e1(e,p,v1){var w1,x1;if(v1.bApiRegistered!==false){return;}sap.ushell.Container.getServiceAsync("PluginManager").then(function(y1){if(w===false){w=true;w1=y1.getPluginLoadingPromise("RendererExtensions");x1=w1&&w1.state();if(x1==="pending"){K=true;w1.always(function(){var z1;K=false;L.debug("Processing post messages queue after 'RendererExtensions' plugins loaded, queue size is: "+x.length,null,"sap.ushell.components.container.ApplicationContainer");for(var i=0;i<x.length;i++){z1=x[i];try{u1.prototype._handleMessageEvent.call(z1.that,z1.oContainer,z1.oMessage);}catch(ex){L.error(ex.message||ex,null,"sap.ushell.components.container.ApplicationContainer");}}x=[];});}}if(K===true){x.push({index:y++,that:this,oContainer:e,oMessage:p});}});}function f1(){w=false;K=false;x=[];y=0;}function g1(e,i){var p=e._getIFrame(),v1=e.getApplicationType();if(k.isApplicationTypeEmbeddedInIframe(e.getApplicationType(v1))&&p){var w1=new f(e._getIFrameUrl(p));var x1=w1.protocol()+"://"+w1.host();p.contentWindow.postMessage(JSON.stringify({action:"pro54_disableDirtyHandler"}),x1);i.preventDefault();}}function h1(e,i,p){e.write("<div").writeControlData(i).writeAccessibilityState(i).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");if(p){e.renderControl(p);}e.write("</div>");}function i1(e,i,p){if(k.isApplicationTypeEmbeddedInIframe(i)){var v1=e.getTargetNavigationMode();p=u1.prototype._adjustNwbcUrl(p,i,v1,e.getIsStateful());k.localStorageSetItem(e.globalDirtyStorageKey,sap.ushell.Container.DirtyState.INITIAL);}return p;}function j1(e,i,p,v1){var w1,x1=function(){var F1=k.getParameterValueBoolean("sap-accessibility");if(F1!==undefined){return F1;}return sap.ushell.Container.getUser().getAccessibilityMode();},y1=function(){var F1=new U(e)||{mParams:{}};if(F1.mParams["sap-theme"]===undefined){return sap.ushell.Container.getUser().getTheme(j.prototype.constants.themeFormat.NWBC);}return undefined;},z1=function(){var F1=false,G1=new U(e)||{mParams:{}};F1=sap.ui.getCore().getConfiguration().getStatistics()&&G1.mParams["sap-statistics"]===undefined;return F1;},A1=function(){var F1=window.hasher&&window.hasher.getHash(),C1="",G1;if(F1&&F1.length>0&&F1.indexOf("sap-iapp-state=")>0){G1=/(?:sap-iapp-state=)([^&/]+)/.exec(F1);if(G1&&G1.length===2){C1=G1[1];}}return C1;},B1=function(){var F1="";var G1=(!!q("body.sapUiSizeCompact").length);var H1=(!!q("body.sapUiSizeCozy").length);if(G1===true){F1="0";}else if(H1){F1="1";}return F1;};e+=e.indexOf("?")>=0?"&":"?";e+="sap-ie=edge";w1=y1();if(w1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-theme="+encodeURIComponent(w1);}if(p){e+=e.indexOf("?")>=0?"&":"?";e+="sap-target-navmode="+encodeURIComponent(p);}if(x1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-accessibility=X";}if(z1()){e+=e.indexOf("?")>=0?"&":"?";e+="sap-statistics=true";}if(i==="TR"||i==="GUI"){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=2";}else if(v1){e+=e.indexOf("?")>=0?"&":"?";e+="sap-keepclientsession=1";}var C1=A1();if(C1&&C1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-iapp-state="+C1;}var D1=B1();if(D1&&D1.length>0){e+=e.indexOf("?")>=0?"&":"?";e+="sap-touch="+D1;}var E1=0;if(h.last("/core/shell/sessionTimeoutIntervalInMinutes")>0){E1=h.last("/core/shell/sessionTimeoutIntervalInMinutes");}e+=e.indexOf("?")>=0?"&":"?";e+="sap-ushell-timeout="+E1;return k.appendSapShellParam(e,i);}function k1(e,i,p,v1){var w1=i.getAggregation("child"),x1,y1;if(!w1||i._bRecreateChild){y1=u1.prototype._createUi5Component(i,p,v1);if(y1.oControl!==undefined){i._bRecreateChild=false;u1.prototype._renderControlInDiv(e,i,y1.oControl);}else{i.oDeferredControlCreation=new q.Deferred();u1.prototype._renderControlInDiv(e,i);y1.oPromise.then(function(z1){i._bRecreateChild=false;x1=sap.ui.getCore().createRenderManager();x1.renderControl(z1);x1.flush(q("#"+i.getId())[0]);x1.destroy();i.oDeferredControlCreation.resolve();});}}else{u1.prototype._renderControlInDiv(e,i,w1);}}function l1(e,i,p){var v1=e.getProperty(i);if(d(v1,p)){return;}e.setProperty(i,p);e._bRecreateChild=true;}function m1(e,i,p,v1,w1){var x1,y1=true;localStorage.removeItem(i.globalDirtyStorageKey);i.oDeferredControlCreation=undefined;if(w1&&w1.indexOf("SAPUI5.Component=")===0&&p===A.URL.type){k1(e,i,v1,w1.replace(/^SAPUI5\.Component=/,""));return;}if(w1&&w1.indexOf("SAPUI5=")===0&&p===A.URL.type){u1.prototype._renderControlInDiv(e,i,undefined,"open");i.oDeferredControlCreation=new q.Deferred();u1.prototype._createUi5View(i,v1,w1).then(function(z1){var C1,D1=q("#"+i.getId());if(D1&&D1.length>0){C1=sap.ui.getCore().createRenderManager();C1.renderControl(z1);C1.flush(q("#"+i.getId())[0]);C1.destroy();}else{e.renderControl(z1);}i.oDeferredControlCreation.resolve();});u1.prototype._renderControlInDiv(e,i,undefined,"close");return;}L.debug("Not resolved as \"SAPUI5.Component=\" or \"SAPUI5=\" , "+"will attempt to load into iframe "+w1);if(!i.getActive()){L.debug("Skipping rendering container iframe","Container '"+i.getId()+"' is inactive");return;}try{v1=i.getFrameSource(p,v1,w1);}catch(ex){L.error(ex.message||ex,null,s);i.fireEvent("applicationConfiguration");e.renderControl(u1.prototype._createErrorControl());return;}if(sap.ushell.Container){x1=u1.prototype._getLogoutHandler(i);if(!x1){if(k.isApplicationTypeEmbeddedInIframe(p)){x1=u1.prototype._logout.bind(null,i);n.put(i.getId(),x1);sap.ushell.Container.attachLogoutEvent(x1);sap.ushell.Container.addRemoteSystem(u1.prototype._createSystemForUrl(v1));}}else if(!k.isApplicationTypeEmbeddedInIframe(p)){sap.ushell.Container.detachLogoutEvent(x1);n.remove(i.getId());}}v1=u1.prototype._checkNwbcUrlAdjustment(i,p,v1);v1=i._adjustURLForIsolationOpeningWithoutURLTemplate(v1);if(p==="TR"){i.setProperty("iframePostAllParams",true,true);}if(new U(window.location.href).get("sap-post")==="false"){y1=false;}else if(window.QUnit!==undefined){y1=i.getIframeWithPost();}if(y1===true&&(p==="NWBC"||p==="TR"||p==="WDA")){i.setProperty("iframeWithPost",true,true);i.oDeferredRenderer=new q.Deferred();v1=u1.prototype._filterURLParams(v1);var A1=[];var B1=u1.prototype._getParamKeys(v1,A1);u1.prototype._generateRootElementForIFrame(e,i,true);if(B1.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(z1){z1.getAppStateData(B1).then(function(C1){var D1;var E1=q("#"+i.getId());if(E1.length>0){D1=sap.ui.getCore().createRenderManager();u1.prototype._buildHTMLElements(D1,i,C1,A1,v1);D1.flush(E1[0]);D1.destroy();}else{u1.prototype._buildHTMLElements(e,i,C1,A1,v1);}setTimeout(i.oDeferredRenderer.resolve,0);},function(C1){u1.prototype._buildHTMLElements(e,i,undefined,A1,v1);setTimeout(i.oDeferredRenderer.resolve,0);});});}else{u1.prototype._buildHTMLElements(e,i,undefined,A1,v1);setTimeout(i.oDeferredRenderer.resolve,0);}u1.prototype._generateRootElementForIFrame(e,i,false);return;}i.fireEvent("applicationConfiguration");e.write("<iframe").writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("src",v1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m);}e.write("></iframe>");}function n1(e){var i=new U(document.URL);if(i.get("sap-isolation-enabled")==="true"){var p=o,v1=p.getHash(document.URL),w1="",x1="&sap-plugins="+encodeURIComponent(sap.ushell.Container.getService("PluginManager")._getNamesOfPluginsWithAgents()),y1="&sap-history-dir="+(H.getInstance().getDirection()?H.getInstance().getDirection():"");if(e.indexOf("&/")>0){w1=e.substr(e.indexOf("&/"));}if(x1==="&sap-plugins="){x1="";}if(v1){var z1=p.parseShellHash("#"+v1),A1=p.paramsToString(z1.params);if(A1&&A1.length>=0){var B1=sap.ushell.Container.getService("AppState").createEmptyAppState(),C1=sap.ushell.Container.getService("AppState").createEmptyAppState(),D1="";if(A1.indexOf("sap-intent-param")>=0){D1=encodeURIComponent(A1);}else{B1.setData(A1);B1.save();D1=encodeURIComponent("sap-intent-param="+B1.getKey());}C1.setData("sap-startup-params="+D1);C1.save();e=e.split("#")[0]+"&sap-intent-param="+C1.getKey()+x1+y1+"#"+window.hasher.getHash();}else{e=e.split("#")[0]+x1+y1+"#"+window.hasher.getHash();}}else{e+="#"+window.hasher.getHash();}if(e.indexOf("&/")<0){e+=w1;}}if(i.has("sap-iframe-params")){var E1=i.get("sap-iframe-params")||"",F1=E1.split(",");F1.forEach(function(G1){if(G1&&G1.length>0){if(i.has(G1)){e=e.split("#")[0]+"&"+G1+"="+i.get(G1)+"#"+e.split("#")[1];}}});}return e;}function o1(e){var i=new f(e);i=i.removeSearch(z);return i.toString();}function p1(e,i){var p=[],v1;if(e.indexOf("sap-intent-param=")>0){v1=/(?:sap-intent-param=)([^&/]+)/.exec(e);if(v1&&v1.length===2){p.push([v1[1]]);i.push("sap-intent-param-data");}}if(e.indexOf("sap-xapp-state=")>0){v1=/(?:sap-xapp-state=)([^&/]+)/.exec(e);if(v1&&v1.length===2){p.push([v1[1]]);i.push("sap-xapp-state-data");}}if(e.indexOf("sap-iapp-state=")>0){v1=/(?:sap-iapp-state=)([^&/]+)/.exec(e);if(v1&&v1.length===2){p.push([v1[1]]);i.push("sap-iapp-state-data");}}return p;}function q1(e,i,p,v1,w1){var x1=i.getId()+"-form",y1="",z1="",A1=false;if(p===undefined){p=[];}p.push([sap.ushell.Container.getFLPUrl(true)]);v1.push("sap-flp-url");p.push([i.getSystemAlias()]);v1.push("system-alias");var B1="";var C1={};v1.forEach(function(G1,H1){if(p[H1][0]){C1[G1]=p[H1][0];}});var D1=w1;B1=JSON.stringify(C1);y1="<input name=\"sap-flp-params\" value=\""+a(B1)+"\">";if(i.getIframePostAllParams()===true){var E1=new U(w1);z1=r1(i,E1);if(z1!==""){w1=s1(w1,E1);}}i.fireEvent("applicationConfiguration");e.write("<form").writeAttributeEscaped("method","post").writeAttributeEscaped("id",x1).writeAttributeEscaped("name",x1).writeAttributeEscaped("target",i.getId()+"-iframe").writeAttributeEscaped("action",w1).addStyle("display","none").writeStyles().write(">").writeAttributeEscaped(y1+z1).write("</form>");var F1=i.sId;if(i.hasStyleClass("sapUShellApplicationContainerIframeHidden")){A1=true;i.toggleStyleClass("sapUShellApplicationContainerIframeHidden",false);}i.sId+="-iframe";e.write("<iframe").writeAttributeEscaped("name",i.getId()).writeControlData(i).writeAccessibilityState(i).writeAttributeEscaped("sap-orig-src",D1).writeAttributeEscaped("title",r.i18n.getText("AppilcationContainer.IframeTitle")).addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles();if(h.last("/core/shell/enableFeaturePolicyInIframes")===true){e.writeAttribute("allow",m.replaceAll(";"," "+(new f(w1).origin())+";"));}e.write("></iframe>");i.sId=F1;if(A1){i.toggleStyleClass("sapUShellApplicationContainerIframeHidden",true);}}function r1(e,i){var v1="";var w1="";var x1="";if(i.has("sap-iframe-hint")){v1=i.get("sap-iframe-hint");}var y1=i.mParams;if(e.getApplicationType()==="TR"||(v1==="GUI")){var p,z1;for(p in y1){if(p==="sap-iframe-hint"||p==="sap-keep-alive"){continue;}z1=y1[p][0];w1="<input name=\""+p+"\" value=\""+a(z1)+"\">";x1+=w1;}}return x1;}function s1(e,i){var p=i.get("sap-iframe-hint"),v1=i.get("sap-keep-alive"),w1=new f(e).query("");if(typeof p==="string"){w1.addSearch("sap-iframe-hint",p);}if(typeof v1==="string"){w1.addSearch("sap-keep-alive",v1);}return w1.toString();}function t1(e,i,p){if(p){e.write("<div").writeControlData(i).writeAttributeEscaped("sap-iframe-app","true").addClass("sapUShellApplicationContainer").writeClasses(i).addStyle("height",i.getHeight()).addStyle("width",i.getWidth()).writeStyles().write(">");}else{e.write("</div>");}}var u1=c.extend(s,{metadata:{properties:{additionalInformation:{defaultValue:"",type:"string"},application:{type:"object"},applicationConfiguration:{type:"object"},applicationType:{defaultValue:"URL",type:P+"ApplicationType"},height:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},navigationMode:{defaultValue:"",type:"string"},targetNavigationMode:{defaultValue:"",type:"string"},text:{defaultValue:"",type:"string"},url:{defaultValue:"",type:"string"},visible:{defaultValue:true,type:"boolean"},active:{defaultValue:true,type:"boolean"},"sap-system":{type:"string"},applicationDependencies:{type:"object"},componentHandle:{type:"object"},ui5ComponentName:{type:"string"},width:{defaultValue:"100%",type:"sap.ui.core.CSSSize"},shellUIService:{type:"object"},appIsolationService:{type:"object"},reservedParameters:{type:"object"},coreResourcesFullyLoaded:{type:"boolean"},isStateful:{defaultValue:false,type:"boolean"},iframeHandlers:{defaultValue:"",type:"string"},iframeWithPost:{defaultValue:false,type:"boolean"},beforeAppCloseEvent:{type:"object"},extendedInfo:{type:"object"},systemAlias:{defaultValue:"",type:"string"},iframePostAllParams:{defaultValue:false,type:"boolean"},isKeepAlive:{defaultValue:false,type:"boolean"},frameworkId:{defaultValue:"",type:"string"},iframeReusedForApp:{defaultValue:false,type:"boolean"}},events:{applicationConfiguration:{}},aggregations:{child:{multiple:false,type:"sap.ui.core.Control",visibility:"hidden"}},library:"sap.ushell",designtime:"sap/ushell/designtime/ApplicationContainer.designtime"},exit:function(){var e,i=this;if(sap.ushell.Container){e=u1.prototype._getLogoutHandler(i);if(e){sap.ushell.Container.detachLogoutEvent(e);n.remove(i.getId());}}localStorage.removeItem(i.globalDirtyStorageKey);if(i._unloadEventListener){removeEventListener("unload",i._unloadEventListener);}if(i._disableRouterEventHandler){sap.ui.getCore().getEventBus().unsubscribe("sap.ushell.components.container.ApplicationContainer","_prior.newUI5ComponentInstantion",i._disableRouterEventHandler);}if(i._storageEventListener){removeEventListener("storage",i._storageEventListener);}if(i._messageEventListener){removeEventListener("message",i._messageEventListener);}u1.prototype._destroyChild(i);if(c.exit){c.exit.apply(i);}},setHandleMessageEvent:function(i){v=i;},init:function(){var e=this;e.globalDirtyStorageKey=l+g();e._unloadEventListener=e.exit.bind(e);addEventListener("unload",e._unloadEventListener);e._storageEventListener=function(i){var p=e.getApplicationType();if(i.key===e.globalDirtyStorageKey&&i.newValue===sap.ushell.Container.DirtyState.PENDING&&k.isApplicationTypeEmbeddedInIframe(p)){var v1=e._getIFrame();if(v1){L.debug("getGlobalDirty() send pro54_getGlobalDirty ",null,"sap.ushell.components.container.ApplicationContainer");var w1=new f(e._getIFrameUrl(v1));var x1=w1.protocol()+"://"+w1.host();v1.contentWindow.postMessage(JSON.stringify({action:"pro54_getGlobalDirty"}),x1);}}};addEventListener("storage",e._storageEventListener);e._messageEventListener=u1.prototype._handleMessageEvent.bind(null,e);addEventListener("message",e._messageEventListener);},onAfterRendering:function(){var e=this;this.rerender=function(){};if(D.os.ios&&this.$().prop("tagName")==="IFRAME"){this.$().parent().css("overflow","auto");}if(this.oDeferredRenderer){this.oDeferredRenderer.done(function(){var i=document.getElementById(e.getId()+"-form");if(i){i.submit();}});}},renderer:function(e,i){var p=i.getApplication(),v1=i.launchpadData,w1;if(!i.getVisible()){u1.prototype._renderControlInDiv(e,i);return;}if(i.error){delete i.error;u1.prototype._renderControlInDiv(e,i,u1.prototype._createErrorControl());}else if(!p){u1.prototype._render(e,i,i.getApplicationType(),i.getUrl(),i.getAdditionalInformation());}else if(!p.isResolvable()){u1.prototype._render(e,i,p.getType(),p.getUrl(),"");}else if(v1){u1.prototype._render(e,i,v1.applicationType,v1.Absolute.url.replace(/\?$/,""),v1.applicationData);}else{L.debug("Resolving "+p.getUrl(),null,s);p.resolve(function(x1){L.debug("Resolved "+p.getUrl(),JSON.stringify(x1),s);i.launchpadData=x1;u1.prototype._destroyChild(i);},function(x1){var y1=p.getMenu().getDefaultErrorHandler();if(y1){y1(x1);}u1.prototype._destroyChild(i);i.error=x1;});w1=new T({text:u1.prototype._getTranslatedText("loading",[p.getText()])});u1.prototype._destroyChild(i);i.setAggregation("child",w1);u1.prototype._renderControlInDiv(e,i,w1);}}});u1.prototype.getFrameSource=function(e,i){if(!Object.prototype.hasOwnProperty.call(A.enum,e)){throw new Error("Illegal application type: "+e);}return i;};u1.prototype.setUrl=function(e){l1(this,"url",e);};u1.prototype.setAdditionalInformation=function(e){l1(this,"additionalInformation",e);};u1.prototype.setApplicationType=function(e){l1(this,"applicationType",e);};u1.prototype.createPostMessageRequest=function(e,i){var p=Date.now().toString();return{type:"request",request_id:p,service:e,body:i};};u1.prototype.setNewTRApplicationContext=function(e){var i=new q.Deferred(),p=this._getIFrame(),v1,w1,x1=this;if(!p){return i.promise().reject({message:"Expected an existing TR application application frame but found none."});}function y1(){if(w1){w1["sap-flp-url"]=sap.ushell.Container.getFLPUrl(true);w1["system-alias"]=x1.getSystemAlias();v1["sap-flp-params"]=w1;}var B1=x1.createPostMessageRequest("sap.its.startService",v1);x1.postMessageToIframe(B1,p,true).then(function(){i.resolve();}).catch(function(C1){i.reject({eventData:C1,message:"Failed to change application context."});});}e=k.appendSapShellParam(e);e=u1.prototype._filterURLParams(e);v1={url:e};if(this.getIframeWithPost&&this.getIframeWithPost()===true){var z1=[];var A1=u1.prototype._getParamKeys(e,z1);if(A1.length>0){sap.ushell.Container.getServiceAsync("CrossApplicationNavigation").then(function(B1){B1.getAppStateData(A1).then(function(C1){w1={};z1.forEach(function(D1,E1){if(C1[E1][0]){w1[D1]=C1[E1][0];}});y1();},function(C1){y1();});});}else{w1={};y1();}}else{y1();}return i.promise();};u1.prototype.postMessageToIframe=function(i,p,v1){var w1=this;var x1=i.request_id;return new Promise(function(y1,z1){function A1(E1){var F1;try{F1=JSON.parse(E1.data,w1);if(x1!==F1.request_id){return;}if(F1.status==="success"){y1(F1);}else{z1(F1);}window.removeEventListener("message",A1);}catch(e){y1();L.warning("Obtained bad response from framework in response to message "+i.request_id);L.debug("Underlying framework returned invalid response data: '"+E1.data+"'");}}var B1=JSON.stringify(i);L.debug("Sending postMessage "+B1+" to application container '"+w1.getId()+"'");var C1=new f(w1._getIFrameUrl(p));var D1=C1.protocol()+"://"+C1.host();if(v1){window.addEventListener("message",A1,false);p.contentWindow.postMessage(B1,D1);}else{p.contentWindow.postMessage(B1,D1);y1();}});};u1.prototype.postMessageToCurrentIframe=function(e,i){if(i===undefined){i=false;}var p=this._getIFrame();if(!p){if(i){return Promise.reject({message:"Expected opened iframe not found."});}return;}return this.postMessageToIframe(e,p,i);};u1.prototype.setNewApplicationContext=function(e,i){var p=this;var v1=this["setNew"+e+"ApplicationContext"];if(!v1){return Promise.reject({message:"Unsupported application type"});}var w1=this._getIFrame();if(!w1){return Promise.reject({message:"Expected an existing TR application application frame but found none."});}var x1=this.createPostMessageRequest("sap.gui.triggerCloseSessionImmediately",{});return this.postMessageToIframe(x1,w1,true).then(function(){return v1.call(p,i);},function(y1){return Promise.reject({eventData:y1,message:"Failed to change application context."});});};u1.prototype.onApplicationOpened=function(e){var i=this.getIsStateful();if(!i){return Promise.resolve();}var p=this.getApplicationType();if(p==="TR"&&e!=="TR"){var v1=this._getIFrame();if(!v1){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var w1=this.createPostMessageRequest("sap.gui.triggerCloseSession",{});return this.postMessageToIframe(w1,v1,false).catch(function(x1){return Promise.reject({eventData:x1,message:"Failed to change application context."});});}return Promise.resolve();};u1.prototype.postMessageRequest=function(e,i){var p=this._getIFrame();if(!p){return Promise.reject({message:"Expected an exisiting TR application application frame but found none."});}var v1=this.createPostMessageRequest(e,i||{});return this.postMessageToIframe(v1,p,false).catch(function(w1){return Promise.reject({eventData:w1,message:"Failed to post message."});});};u1.prototype.sendBeforeAppCloseEvent=function(){var e=this.getBeforeAppCloseEvent&&this.getBeforeAppCloseEvent(),i;if(e&&e.enabled&&e.enabled===true){i=this.createPostMessageRequest("sap.ushell.services.CrossApplicationNavigation.beforeAppCloseEvent",e.params);return this.postMessageToIframe(i,this._getIFrame(),true);}return undefined;};u1.prototype.getDeffedControlCreation=function(e){return this.oDeferredControlCreation?this.oDeferredControlCreation.promise():q.Deferred().resolve().promise();};u1.prototype._getCommunicationHandlers=J;u1.prototype._adaptIsUrlSupportedResultForMessagePopover=B;u1.prototype._getLogoutHandler=G;u1.prototype._getParameterMap=N;u1.prototype._getTranslatedText=O;u1.prototype._createErrorControl=Q;u1.prototype._destroyChild=R;u1.prototype._createUi5View=W;u1.prototype._publishExternalEvent=X;u1.prototype._createUi5Component=Y;u1.prototype._disableRouter=Z;u1.prototype._createSystemForUrl=$;u1.prototype._isTrustedPostMessageSource=_;u1.prototype._handleMessageEvent=d1;u1.prototype._logout=g1;u1.prototype._renderControlInDiv=h1;u1.prototype._checkNwbcUrlAdjustment=i1;u1.prototype._adjustNwbcUrl=j1;u1.prototype._render=m1;u1.prototype._getParamKeys=p1;u1.prototype._buildHTMLElements=q1;u1.prototype._buildHTMLForAllPostParams=r1;u1.prototype._generateRootElementForIFrame=t1;u1.prototype._backButtonPressedCallback=a1;u1.prototype._getIFrame=b1;u1.prototype._getIFrameUrl=c1;u1.prototype._filterURLParams=o1;u1.prototype._adjustURLForIsolationOpeningWithoutURLTemplate=n1;u1.prototype._resetPluginsLoadIndications=f1;u1.prototype._handlePostMessagesForPluginsPostLoading=e1;return u1;},true);
