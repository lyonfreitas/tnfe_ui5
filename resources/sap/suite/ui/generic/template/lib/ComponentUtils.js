sap.ui.define(["sap/ui/base/Object","sap/ui/model/base/ManagedObjectModel","sap/suite/ui/generic/template/genericUtilities/controlHelper","sap/suite/ui/generic/template/genericUtilities/FeLogger","sap/suite/ui/generic/template/lib/CRUDActionHandler","sap/suite/ui/generic/template/lib/StatePreserver","sap/base/util/extend","sap/base/util/isEmptyObject","sap/suite/ui/generic/template/genericUtilities/FeError"],function(B,M,c,F,C,S,e,a,b){"use strict";var s="lib.ComponentUtils";var l=new F(s).getLogger();var d={isPreliminary:function(){return false;}};function g(o,f){var t=f.oTemplateContract.mRoutingTree[f.route];var h;var H;var j;var k;var D=false;var m;var I=false;var L;var n=[];var N=false;var E=[];function p(){return o.getModel("_templPriv");}function q(i){f.oTemplateContract.oNavigationControllerProxy.preloadComponent(i);}function r(){var i=o.getAppComponent();return i.getModel("_templPrivGlobal");}function u(){return t.level;}function v(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(i){var W1={};var X1=i.getPath(2,v1());W1.bindingContext=o.getModel().createBindingContext(X1)||o.getModel().getContext(X1);W1.entitySet=i.entitySet;W1.view=i.componentId&&f.oTemplateContract.componentRegistry[i.componentId].oController.getView();W1.componentId=i.componentId;return W1;}return null;}function w(){var i=f.oTemplateContract.oApplicationProxy.getAncestralNode(t,1);if(!i.componentId){q(i.sRouteName);}return i.componentCreated.then(function(o){var W1=f.oTemplateContract.componentRegistry[o.getId()];return W1.viewRegistered.then(function(){return{getText:W1.oControllerUtils.oCommonUtils.getText,getRootExpand:W1.oControllerUtils.oComponentUtils.getRootExpand};});});}function x(){return f.preprocessorsData;}function y(W1){var X1=f.oTemplateContract.oNavigationControllerProxy.getCurrentIdentity();var Y1=X1.keys;var Z1=[];for(var i=0;i<W1;i++){Z1[i]="";}var $1=f.oTemplateContract.oApplicationProxy.fillSiblingKeyPromise(X1.treeNode,Y1,Z1,"Changes");return $1.then(function(_1){return{keys:Z1,treeNode:_1};});}function z(){var i=x();if(i&&i.rootContextExpand){return i.rootContextExpand.join(',');}}function A(){return f.oParameterModel;}function G(i,W1,X1){if(typeof X1!=="function"){throw new b(s,"Event handler must be a function");}E.push({template:i,event:W1,handler:X1});}function J(W1,X1,Y1){for(var i=E.length;i--;){if(E[i].handler===Y1&&E[i].event===X1&&E[i].template===W1){E.splice(i,1);}}}function K(W1,X1,Y1){for(var i=0;i<E.length;i++){if(E[i].event===X1&&E[i].template===W1){E[i].handler(Y1);}}}function O(i){return i.getMetadata().getName();}function P(){return f.oApplication.isComponentActive(o);}function Q(){return f.oNavigationObserver.getProcessFinished(true);}function R(i,W1){var X1=Q();X1.then(function(){if(P()){if(W1){f1(true,false);}K(O(f.oController),"PageDataLoaded",{context:i});if(i&&B1()){var Y1=i.getObject();if(!Y1.IsActiveEntity){f.oApplication.getDraftSiblingPromise(i);}}}});}function T(){h.then(function(i){if(i){R(i);}});}function U(){f.oHeaderLoadingObserver.startProcess();if(!m){var i=new Promise(function(W1){m=W1;});f.oApplication.getBusyHelper().setBusy(i,undefined,undefined,true);}}function V(){if(!H){h=new Promise(function(i){H=i;});}}if(t.getPath(3)){V();}else{h=Promise.resolve();}function W(i){l.info("Request header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");I=true;V();if(!o.getComponentContainer().getElementBinding().isSuspended()){U();}}function X(){if(m){m();m=null;}f.oHeaderLoadingObserver.stopProcess();}function Y(i){var W1=i.getSource().getBoundContext();if(W1){return W1;}if(o.getComponentContainer().getElementBinding().isSuspended()){W1=null;}else{W1=d;}d1();return W1;}function Z(){D=true;var i=f.oTemplateContract.oNavigationControllerProxy.getActiveComponents();var W1=i.find(function(Z1){return f.oTemplateContract.componentRegistry[Z1].utils.getDataNotExisting();});var X1=f.oTemplateContract.componentRegistry[W1];var Y1=f.oTemplateContract.mRoutingTree[X1.route];f.oTemplateContract.oNavigationControllerProxy.navigationContextNotFound(Y1);}function $(){return D;}function _(){I=false;if(!k){return;}if(k===d){Z();d1();}else if(!o.getComponentContainer().getElementBinding().isSuspended()){var i=o.getBindingContext();var W1=r1(i);var X1=W1.bIsDraft||N;var Y1;if(X1){N=false;Y1=W1.bIsCreate?4:2;}else{Y1=1;}var Z1=p();Z1.setProperty("/objectPage/displayMode",Y1);var $1=o.getModel("ui");$1.setProperty("/enabled",true);$1.setProperty("/createMode",W1.bIsCreate);$1.setProperty("/editable",X1);(f.methods.updateBindingContext||Function.prototype)(i);if(H){H(k);}}else{return;}H=null;k=null;}function a1(i){l.info("Received header data",i.getSource().getPath(),"Class sap.suite.ui.generic.template.lib.ComponentUtils");j();X();if(I){k=Y(i);}_();}function b1(i){j();var W1=Y(i);if(W1&&W1.isPreliminary()){return;}k=W1;_();f.oHeaderLoadingObserver.stopProcess();}function c1(i){D=false;f.oHeaderLoadingObserver.startProcess();var W1=new Promise(function(X1){j=X1;});V();if(f.methods.beforeRebind){f.methods.beforeRebind(W1);}k=null;t.bindElement(o.getComponentContainer(),i,false,{dataRequested:W,dataReceived:a1,change:b1});L=i;if(f.methods.afterRebind){f.methods.afterRebind();}}function d1(){V();var i=o.getComponentContainer();i.setBindingContext();t.unbindElement(i);L=null;k=null;I=false;X();}function e1(){var W1=v1();var X1=(W1.length===n.length);for(var i=0;i<W1.length&&X1;i++){X1=W1[i]===n[i];}n=W1;return!X1;}function f1(i,W1){f.reuseComponentsReady.then(function(X1){for(var Y1 in X1){var Z1=X1[Y1];if(!W1||Z1.isStarted()){Z1.pathUnchangedCallBack(i);}}});}function g1(i,W1){var X1=Object.create(null);for(var Y1 in i){var Z1=i[Y1];X1[Y1]=W1(Z1,Y1);}return X1;}function h1(){var i=p();for(var W1 in t.embeddedComponents){var X1=!!t.embeddedComponents[W1].definition.hiddenByDefault;i.setProperty("/generic/embeddedComponents/"+W1+"/hidden",X1);}}function i1(i,W1){var X1=e1();if(X1&&!W1){h1();}if(!i){if(f.routingSpec&&f.routingSpec.noOData){R(null,X1);}return;}var Y1=o.getComponentContainer();if(!Y1){return;}var Z1=o.getModel("ui");var $1=!!f.nonDraftCreateContext;if($1){var _1=Y1.getBindingContext();if(_1===f.nonDraftCreateContext){return;}Z1.setProperty("/enabled",true);Z1.setProperty("/editable",true);Z1.setProperty("/createMode",true);d1();if(H){H(f.nonDraftCreateContext);H=null;}else{h=Promise.resolve(f.nonDraftCreateContext);}T();if(f.methods.beforeRebind){f.methods.beforeRebind(h);}Y1.setBindingContext(f.nonDraftCreateContext);Promise.all([f.oViewRenderedPromise,f.viewRegistered]).then(f1.bind(null,true,false));if(f.methods.afterRebind){f.methods.afterRebind();}}else{var a2=Y1.getElementBinding();if(a2){if(L===i){if(a2.isSuspended()){a2.resume();_();}if(I){U();}f.oApplication.getBusyHelper().getUnbusy().then(f1.bind(null,X1,false));if(!W1){T();}if(!W1&&!B1()){Z1.setProperty("/editable",false);}Z1.setProperty("/enabled",true);return;}else if(!W1){d1();}}Z1.setProperty("/enabled",false);Z1.setProperty("/editable",false);Z1.setProperty("/createMode",false);c1(i);T();}}function j1(i,W1){var X1={};if(i){X1.discardPromise=i;}var Y1=o.getModel();if(Y1.hasPendingChanges()){var Z1=f.oController.getView();Z1.setBindingContext(null);Y1.resetChanges();Z1.setBindingContext();}var $1=o.getModel("ui");if(W1||$1.getProperty("/editable")){delete f.nonDraftCreateContext;if(!i){delete f.nonDraftCreateContext;$1.setProperty("/editable",false);var _1=p();_1.setProperty("/objectPage/displayMode",1);}K(O(f.oController),"AfterCancel",X1);}}function k1(i,W1){return B1()?null:f.oTemplateContract.oNavigationControllerProxy.navigateForNonDraftCreate(i,W1);}function l1(i,W1){N=W1;f.oTemplateContract.oNavigationControllerProxy.adaptUrlAfterNonDraftCreateSaved(i);}function m1(i){var W1=o.getComponentContainer().getElementBinding();if(W1){o.getModel().invalidateEntry(W1.getBoundContext());if(W1.isSuspended()){d1();}else{W1.refresh(!i);f.bWithoutAssociationsRefresh=false;}}}function n1(i){i=i||o.getIsRefreshRequired();if(i||!a(f.mRefreshInfos)||f.bWithoutAssociationsRefresh){(f.methods.refreshBinding||Function.prototype)(i,f.mRefreshInfos,f.bWithoutAssociationsRefresh);o.setIsRefreshRequired(false);f.mRefreshInfos=Object.create(null);}f1(i,true);}function o1(){var i=o.getModel();var W1={canonicalRequest:!f.oTemplateContract.bCreateRequestsCanonical,batchGroupId:"facets",updateAggregatedMessages:true};i.read(L,W1);}function p1(i){if(B1()){var W1=o.getComponentContainer();var X1=W1.getElementBinding();if(X1&&!X1.isSuspended()){X1.suspend();i.catch(function(){X1.resume();});}}}function q1(){var i=o.getComponentContainer();if(f.nonDraftCreateContext){i.setBindingContext();delete f.nonDraftCreateContext;return;}var W1=i.getElementBinding();if(W1&&!W1.isSuspended()){if(f.oTemplateContract.oValidationMessageBinding.getLength()){d1();}else{W1.suspend();}X();}}function r1(i){var W1=u();return f.oApplication.registerContext(i,W1,o.getEntitySet(),v1());}function s1(i){if(i.level<2){return[i.entitySet];}var W1=f.oTemplateContract.mRoutingTree[i.parentRoute];var X1=s1(W1);if(i!==t){X1.push(i.navigationProperty?X1[W1.level-1]+"/"+i.navigationProperty:i.entitySet);}return X1;}function t1(){return t.level<2?[]:s1(t);}function u1(i,W1,X1){var Y1;for(Y1=t;Y1.level>X1;){Y1=f.oTemplateContract.mRoutingTree[Y1.parentRoute];}var Z1=new M(i);Z1.bindProperty("/"+W1).attachChange(function($1){var _1=$1.getSource().getValue();f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(Y1,_1);});Y1.contextTargets=Y1.contextTargets||[];Y1.contextTargets.push(i);}function v1(){return f.oApplication.getCurrentKeys(u());}function w1(i){return f.oApplication.getCommunicationObject(o,i);}function x1(i,W1,X1,Y1,Z1){f.oTemplateContract.oNavigationControllerProxy.navigateToChild(t,i,X1,W1,Y1,Z1);}function y1(i,W1,X1){f.oTemplateContract.oNavigationControllerProxy.navigateFromNodeAccordingToContext(t,i,W1,X1);}function z1(){return t.headerTitle;}function A1(i){f.oTemplateContract.oNavigationControllerProxy.setTextForTreeNode(t,i);}function B1(){return t.isDraft;}function C1(){return!(f.routingSpec&&f.routingSpec.noOData);}function D1(){return!f.oTemplateContract.bCreateRequestsCanonical;}function E1(){return h;}function F1(){return f.oTemplateContract.oPaginatorInfo[u()-1];}function G1(i,W1){var X1=u();if(!W1){X1--;}f.oTemplateContract.oPaginatorInfo[X1]=i;}function H1(i,W1){f.reuseComponentsReady.then(function(X1){var Y1=W1.getComponentInstance();for(var Z1 in X1){if(Y1===X1[Z1].component){var $1=p();$1.setProperty("/generic/embeddedComponents/"+Z1+"/isInVisibleArea",i);return;}}});}function I1(){return f.oStatePreserverPromise.then(function(i){return i.stateChanged();});}f.oStatePreserverPromise=f.reuseComponentsReady.then(function(i){var W1=f.methods.getStatePreserverSettings&&f.methods.getStatePreserverSettings();if(!W1){return{getUrlParameterInfo:function(){return Promise.resolve({});},applyAppState:Function.prototype,stateChanged:Function.prototype};}var X1="sap-iapp-state"+(t.level===0?"":"-"+t.entitySet);var Y1=e({appStateName:encodeURI(X1),getCurrentState:function(){var $1=f.methods.getCurrentState?f.methods.getCurrentState():Object.create(null);var _1=function(a2,b2){if(a2.component.stGetCurrentState){var c2=a2.component.stGetCurrentState();for(var d2 in c2){$1["$embeddedComponent$"+b2.length+"$"+b2+"$"+d2]=c2[d2];}}};g1(i,_1);return $1;},applyState:function($1,_1){var a2=Object.create(null);var b2=Object.create(null);for(var c2 in $1){if(c2.indexOf("$embeddedComponent$")===0){var d2=c2.substring(19);var e2=d2.indexOf("$");var f2=Number(d2.substring(0,e2));var g2=d2.substring(e2+1,e2+f2+1);var h2=b2[g2];if(!h2){h2=Object.create(null);b2[g2]=h2;}var i2=d2.substring(e2+f2+2);h2[i2]=$1[c2];}else{a2[c2]=$1[c2];}}(f.methods.applyState||Function.prototype)(a2,_1);var j2=function(k2,l2){if(k2.component.stApplyState){k2.component.stApplyState(b2[l2]||Object.create(null),_1);}};Promise.all([f.oViewRenderedPromise,h]).then(g1.bind(null,i,j2));},oComponent:o},W1);var Z1=new S(f.oTemplateContract,Y1);f.oApplication.registerStateChanger(Z1.getAsStateChanger());return Z1;});f.oTemplateContract.oStatePreserversAvailablePromise=Promise.all([f.oTemplateContract.oStatePreserversAvailablePromise,f.oStatePreserverPromise]);function J1(){var i=f.oTemplateContract.oFlexibleColumnLayoutHandler;return i?i.getFclProxy(t):{handleDataReceived:t.level?null:Function.prototype,isListAndFirstEntryLoadedOnStartup:t.level?null:Function.prototype,isNextObjectLoadedAfterDelete:Function.prototype};}function K1(){return t.page.component.settings||{};}function L1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var W1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.controllerExtensions"];W1=W1&&W1[f.methods.oComponentData.templateName];W1=W1&&W1["sap.ui.generic.app"];return W1&&W1[o.getEntitySet()];}function M1(){var i=o.getAppComponent().getManifestEntry("sap.ui5");var W1=i.extends&&i.extends.extensions&&i.extends.extensions["sap.ui.viewExtensions"];return W1&&W1[f.methods.oComponentData.templateName];}function N1(i){f.aUnsavedDataCheckFunctions=f.aUnsavedDataCheckFunctions||[];f.aUnsavedDataCheckFunctions.push(i);}function O1(){if(f.methods.adaptToChildContext){var i=p().getProperty("/generic/currentActiveChildContext");f.methods.adaptToChildContext(i);}}var P1;function Q1(){P1=P1||new C(f.oTemplateContract,f.oController,f.oControllerUtils.oCommonUtils);return P1;}function R1(i){if(f.methods.executeAfterInvokeActionFromExtensionAPI){f.methods.executeAfterInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function S1(i){if(f.methods.executeBeforeInvokeActionFromExtensionAPI){f.methods.executeBeforeInvokeActionFromExtensionAPI(i,f.oControllerUtils.oCommonUtils);}}function T1(){var i=f.oController.getView();var W1=i.getModel();if(W1.hasPendingChanges(true)){return true;}if(f.aUnsavedDataCheckFunctions){return f.aUnsavedDataCheckFunctions.some(function(X1){return X1();});}return false;}function U1(i){if(f.reactivate&&!i){return;}var W1=f.oController.onLeaveAppExtension&&f.oController.onLeaveAppExtension.apply(f.oController,[i]);f.reactivate=f.reuseComponentsReady.then(function(X1){var Y1=Object.create(null);g1(X1,function(Z1,$1){var _1=Z1.leaveApp(i);if(_1&&!i){Y1[$1]=_1;}});return!i&&function(){if(W1){W1();}for(var Z1 in Y1){Y1[Z1]();}};});}function V1(){if(f.oTemplateContract.oFlexibleColumnLayoutHandler){f.oTemplateContract.oFlexibleColumnLayoutHandler.hidePlaceholder(t.fCLLevel);}else{f.oTemplateContract.oNavigationHost.hidePlaceholder();}}return{getBusyHelper:function(){return f.oApplication.getBusyHelper();},attach:function(i,W1,X1){G(O(i),W1,X1);},detach:function(i,W1,X1){J(O(i),W1,X1);},fire:function(i,W1,X1){K(O(i),W1,X1);},getPreprocessorsData:x,getRootExpand:z,getParameterModelForTemplating:A,bindComponent:i1,cancelEdit:j1,getNonDraftCreatePromise:k1,adaptUrlAfterNonDraftCreateSaved:l1,refreshBinding:n1,refreshBindingUnconditional:m1,suspendBinding:q1,messagesRefresh:o1,getTemplatePrivateModel:p,getTemplatePrivateGlobalModel:r,registerContext:r1,getViewLevel:u,getMainComponentDetails:v,getMainComponentUtils:w,getBreadCrumbInfo:t1,registerAncestorTitleUpdater:u1,getCurrentKeys:v1,getCommunicationObject:w1,navigateRoute:x1,navigateAccordingToContext:y1,getTitle:z1,setText:A1,onBeforeDraftTransfer:p1,isDraftEnabled:B1,isODataBased:C1,getNoStateMessagesForTables:D1,isComponentActive:P,getDataNotExisting:$,getHeaderDataAvailablePromise:E1,getPaginatorInfo:F1,setPaginatorInfo:G1,onVisibilityChangeOfReuseComponent:H1,getNavigationFinishedPromise:Q,stateChanged:I1,unbind:d1,getFclProxy:J1,getSettings:K1,getControllerExtensions:L1,getViewExtensions:M1,registerUnsavedDataCheckFunction:N1,layoutChanged:O1,getCRUDActionHandler:Q1,executeAfterInvokeActionFromExtensionAPI:R1,executeBeforeInvokeActionFromExtensionAPI:S1,preloadComponent:q,isComponentDirty:T1,getTargetKeyFromLevel:y,leaveApp:U1,hidePlaceholder:V1};}return B.extend("sap.suite.ui.generic.template.lib.ComponentUtils",{constructor:function(o,f){e(this,g(o,f));}});});
